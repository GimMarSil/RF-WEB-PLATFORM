"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/evaluation-matrices";
exports.ids = ["pages/api/evaluation-matrices"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("pg");

/***/ }),

/***/ "@azure/msal-browser":
/*!**************************************!*\
  !*** external "@azure/msal-browser" ***!
  \**************************************/
/***/ ((module) => {

module.exports = import("@azure/msal-browser");;

/***/ }),

/***/ "@azure/msal-node":
/*!***********************************!*\
  !*** external "@azure/msal-node" ***!
  \***********************************/
/***/ ((module) => {

module.exports = import("@azure/msal-node");;

/***/ }),

/***/ "zod":
/*!**********************!*\
  !*** external "zod" ***!
  \**********************/
/***/ ((module) => {

module.exports = import("zod");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fevaluation-matrices&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cevaluation-matrices%5Cindex.ts&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fevaluation-matrices&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cevaluation-matrices%5Cindex.ts&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_evaluation_matrices_index_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src\\pages\\api\\evaluation-matrices\\index.ts */ \"(api)/./src/pages/api/evaluation-matrices/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_evaluation_matrices_index_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_evaluation_matrices_index_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_evaluation_matrices_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_evaluation_matrices_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/evaluation-matrices\",\n        pathname: \"/api/evaluation-matrices\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_evaluation_matrices_index_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmV2YWx1YXRpb24tbWF0cmljZXMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZzcmMlNUNwYWdlcyU1Q2FwaSU1Q2V2YWx1YXRpb24tbWF0cmljZXMlNUNpbmRleC50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUM2RTtBQUM3RTtBQUNBLGlFQUFlLHdFQUFLLENBQUMsd0VBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLHdFQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2F6dXJlLWFkLWxvZ2luLWFwcC8/OTc0MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vc3JjXFxcXHBhZ2VzXFxcXGFwaVxcXFxldmFsdWF0aW9uLW1hdHJpY2VzXFxcXGluZGV4LnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZXZhbHVhdGlvbi1tYXRyaWNlc1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2V2YWx1YXRpb24tbWF0cmljZXNcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fevaluation-matrices&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cevaluation-matrices%5Cindex.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/lib/db/pool.ts":
/*!****************************!*\
  !*** ./src/lib/db/pool.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   executeQuery: () => (/* binding */ executeQuery),\n/* harmony export */   executeTransaction: () => (/* binding */ executeTransaction),\n/* harmony export */   pool: () => (/* binding */ pool)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(pg__WEBPACK_IMPORTED_MODULE_0__);\n\nif (!process.env.DATABASE_URL) {\n    throw new Error(\"DATABASE_URL environment variable is not set\");\n}\n// Validate SSL configuration\nconst sslConfig =  false ? 0 : undefined;\n// Create a single pool instance to be reused across the application\nconst pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n    connectionString: process.env.DATABASE_URL,\n    ssl: sslConfig,\n    max: 20,\n    idleTimeoutMillis: 30000,\n    connectionTimeoutMillis: 2000\n});\n// Handle pool errors\npool.on(\"error\", (err)=>{\n    console.error(\"Unexpected error on idle client\", err);\n    process.exit(-1);\n});\n// Helper function to execute queries with proper error handling\nasync function executeQuery(query, params = [], client) {\n    const shouldRelease = !client;\n    const queryClient = client || await pool.connect();\n    try {\n        const result = await queryClient.query(query, params);\n        return result.rows;\n    } catch (error) {\n        console.error(\"Database query error:\", error);\n        throw error;\n    } finally{\n        if (shouldRelease) {\n            queryClient.release();\n        }\n    }\n}\n// Helper function to execute transactions\nasync function executeTransaction(callback) {\n    const client = await pool.connect();\n    try {\n        await client.query(\"BEGIN\");\n        const result = await callback(client);\n        await client.query(\"COMMIT\");\n        return result;\n    } catch (error) {\n        await client.query(\"ROLLBACK\");\n        throw error;\n    } finally{\n        client.release();\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL2RiL3Bvb2wudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBMEI7QUFFMUIsSUFBSSxDQUFDQyxRQUFRQyxHQUFHLENBQUNDLFlBQVksRUFBRTtJQUM3QixNQUFNLElBQUlDLE1BQU07QUFDbEI7QUFFQSw2QkFBNkI7QUFDN0IsTUFBTUMsWUFBWUosTUFBeUIsR0FDdkMsQ0FBNkIsR0FDN0JNO0FBRUosb0VBQW9FO0FBQzdELE1BQU1DLE9BQU8sSUFBSVIsb0NBQUlBLENBQUM7SUFDM0JTLGtCQUFrQlIsUUFBUUMsR0FBRyxDQUFDQyxZQUFZO0lBQzFDTyxLQUFLTDtJQUNMTSxLQUFLO0lBQ0xDLG1CQUFtQjtJQUNuQkMseUJBQXlCO0FBQzNCLEdBQUc7QUFFSCxxQkFBcUI7QUFDckJMLEtBQUtNLEVBQUUsQ0FBQyxTQUFTLENBQUNDO0lBQ2hCQyxRQUFRQyxLQUFLLENBQUMsbUNBQW1DRjtJQUNqRGQsUUFBUWlCLElBQUksQ0FBQyxDQUFDO0FBQ2hCO0FBRUEsZ0VBQWdFO0FBQ3pELGVBQWVDLGFBQ3BCQyxLQUFhLEVBQ2JDLFNBQWdCLEVBQUUsRUFDbEJDLE1BQVk7SUFFWixNQUFNQyxnQkFBZ0IsQ0FBQ0Q7SUFDdkIsTUFBTUUsY0FBY0YsVUFBVSxNQUFNZCxLQUFLaUIsT0FBTztJQUVoRCxJQUFJO1FBQ0YsTUFBTUMsU0FBUyxNQUFNRixZQUFZSixLQUFLLENBQUNBLE9BQU9DO1FBQzlDLE9BQU9LLE9BQU9DLElBQUk7SUFDcEIsRUFBRSxPQUFPVixPQUFPO1FBQ2RELFFBQVFDLEtBQUssQ0FBQyx5QkFBeUJBO1FBQ3ZDLE1BQU1BO0lBQ1IsU0FBVTtRQUNSLElBQUlNLGVBQWU7WUFDakJDLFlBQVlJLE9BQU87UUFDckI7SUFDRjtBQUNGO0FBRUEsMENBQTBDO0FBQ25DLGVBQWVDLG1CQUNwQkMsUUFBcUM7SUFFckMsTUFBTVIsU0FBUyxNQUFNZCxLQUFLaUIsT0FBTztJQUVqQyxJQUFJO1FBQ0YsTUFBTUgsT0FBT0YsS0FBSyxDQUFDO1FBQ25CLE1BQU1NLFNBQVMsTUFBTUksU0FBU1I7UUFDOUIsTUFBTUEsT0FBT0YsS0FBSyxDQUFDO1FBQ25CLE9BQU9NO0lBQ1QsRUFBRSxPQUFPVCxPQUFPO1FBQ2QsTUFBTUssT0FBT0YsS0FBSyxDQUFDO1FBQ25CLE1BQU1IO0lBQ1IsU0FBVTtRQUNSSyxPQUFPTSxPQUFPO0lBQ2hCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9henVyZS1hZC1sb2dpbi1hcHAvLi9zcmMvbGliL2RiL3Bvb2wudHM/YzMxZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQb29sIH0gZnJvbSAncGcnO1xyXG5cclxuaWYgKCFwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwpIHtcclxuICB0aHJvdyBuZXcgRXJyb3IoJ0RBVEFCQVNFX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0Jyk7XHJcbn1cclxuXHJcbi8vIFZhbGlkYXRlIFNTTCBjb25maWd1cmF0aW9uXHJcbmNvbnN0IHNzbENvbmZpZyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgXHJcbiAgPyB7IHJlamVjdFVuYXV0aG9yaXplZDogZmFsc2UgfSBcclxuICA6IHVuZGVmaW5lZDtcclxuXHJcbi8vIENyZWF0ZSBhIHNpbmdsZSBwb29sIGluc3RhbmNlIHRvIGJlIHJldXNlZCBhY3Jvc3MgdGhlIGFwcGxpY2F0aW9uXHJcbmV4cG9ydCBjb25zdCBwb29sID0gbmV3IFBvb2woe1xyXG4gIGNvbm5lY3Rpb25TdHJpbmc6IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCxcclxuICBzc2w6IHNzbENvbmZpZyxcclxuICBtYXg6IDIwLCAvLyBNYXhpbXVtIG51bWJlciBvZiBjbGllbnRzIGluIHRoZSBwb29sXHJcbiAgaWRsZVRpbWVvdXRNaWxsaXM6IDMwMDAwLCAvLyBIb3cgbG9uZyBhIGNsaWVudCBpcyBhbGxvd2VkIHRvIHJlbWFpbiBpZGxlIGJlZm9yZSBiZWluZyBjbG9zZWRcclxuICBjb25uZWN0aW9uVGltZW91dE1pbGxpczogMjAwMCwgLy8gSG93IGxvbmcgdG8gd2FpdCBmb3IgYSBjb25uZWN0aW9uXHJcbn0pO1xyXG5cclxuLy8gSGFuZGxlIHBvb2wgZXJyb3JzXHJcbnBvb2wub24oJ2Vycm9yJywgKGVycikgPT4ge1xyXG4gIGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgZXJyb3Igb24gaWRsZSBjbGllbnQnLCBlcnIpO1xyXG4gIHByb2Nlc3MuZXhpdCgtMSk7XHJcbn0pO1xyXG5cclxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgcXVlcmllcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVF1ZXJ5PFQgPSBhbnk+KFxyXG4gIHF1ZXJ5OiBzdHJpbmcsXHJcbiAgcGFyYW1zOiBhbnlbXSA9IFtdLFxyXG4gIGNsaWVudD86IGFueVxyXG4pOiBQcm9taXNlPFRbXT4ge1xyXG4gIGNvbnN0IHNob3VsZFJlbGVhc2UgPSAhY2xpZW50O1xyXG4gIGNvbnN0IHF1ZXJ5Q2xpZW50ID0gY2xpZW50IHx8IGF3YWl0IHBvb2wuY29ubmVjdCgpO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBxdWVyeUNsaWVudC5xdWVyeShxdWVyeSwgcGFyYW1zKTtcclxuICAgIHJldHVybiByZXN1bHQucm93cztcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgcXVlcnkgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfSBmaW5hbGx5IHtcclxuICAgIGlmIChzaG91bGRSZWxlYXNlKSB7XHJcbiAgICAgIHF1ZXJ5Q2xpZW50LnJlbGVhc2UoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIEhlbHBlciBmdW5jdGlvbiB0byBleGVjdXRlIHRyYW5zYWN0aW9uc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVRyYW5zYWN0aW9uPFQgPSBhbnk+KFxyXG4gIGNhbGxiYWNrOiAoY2xpZW50OiBhbnkpID0+IFByb21pc2U8VD5cclxuKTogUHJvbWlzZTxUPiB7XHJcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgcG9vbC5jb25uZWN0KCk7XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnQkVHSU4nKTtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhbGxiYWNrKGNsaWVudCk7XHJcbiAgICBhd2FpdCBjbGllbnQucXVlcnkoJ0NPTU1JVCcpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdST0xMQkFDSycpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfSBmaW5hbGx5IHtcclxuICAgIGNsaWVudC5yZWxlYXNlKCk7XHJcbiAgfVxyXG59ICJdLCJuYW1lcyI6WyJQb29sIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsIkVycm9yIiwic3NsQ29uZmlnIiwicmVqZWN0VW5hdXRob3JpemVkIiwidW5kZWZpbmVkIiwicG9vbCIsImNvbm5lY3Rpb25TdHJpbmciLCJzc2wiLCJtYXgiLCJpZGxlVGltZW91dE1pbGxpcyIsImNvbm5lY3Rpb25UaW1lb3V0TWlsbGlzIiwib24iLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJleGl0IiwiZXhlY3V0ZVF1ZXJ5IiwicXVlcnkiLCJwYXJhbXMiLCJjbGllbnQiLCJzaG91bGRSZWxlYXNlIiwicXVlcnlDbGllbnQiLCJjb25uZWN0IiwicmVzdWx0Iiwicm93cyIsInJlbGVhc2UiLCJleGVjdXRlVHJhbnNhY3Rpb24iLCJjYWxsYmFjayJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/db/pool.ts\n");

/***/ }),

/***/ "(api)/./src/lib/evaluation/validation.ts":
/*!******************************************!*\
  !*** ./src/lib/evaluation/validation.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   calculateWeightedScore: () => (/* binding */ calculateWeightedScore),\n/* harmony export */   isDateInRange: () => (/* binding */ isDateInRange),\n/* harmony export */   isValidDateRange: () => (/* binding */ isValidDateRange),\n/* harmony export */   isValidScoreRange: () => (/* binding */ isValidScoreRange),\n/* harmony export */   validateEmployeeEvaluationInput: () => (/* binding */ validateEmployeeEvaluationInput),\n/* harmony export */   validateEvaluationPeriod: () => (/* binding */ validateEvaluationPeriod),\n/* harmony export */   validateEvaluationUpdate: () => (/* binding */ validateEvaluationUpdate),\n/* harmony export */   validateMatrixInput: () => (/* binding */ validateMatrixInput),\n/* harmony export */   validateScoreInputs: () => (/* binding */ validateScoreInputs),\n/* harmony export */   validateSelfEvaluationInput: () => (/* binding */ validateSelfEvaluationInput),\n/* harmony export */   validateSelfEvaluationUpdate: () => (/* binding */ validateSelfEvaluationUpdate),\n/* harmony export */   validateSelfScoreInputs: () => (/* binding */ validateSelfScoreInputs),\n/* harmony export */   validateStatusTransition: () => (/* binding */ validateStatusTransition),\n/* harmony export */   validateWeightsSum: () => (/* binding */ validateWeightsSum)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"zod\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([zod__WEBPACK_IMPORTED_MODULE_0__]);\nzod__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n// Base schemas for reuse\nconst dateSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\");\nconst statusSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n    \"draft\",\n    \"in_progress\",\n    \"submitted\",\n    \"validated\",\n    \"cancelled\",\n    \"acknowledged\"\n]);\n// Validation schemas\nconst evaluationCriterionSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    name: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1, \"Criterion name is required\"),\n    description: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    weight: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().min(0.01).max(100),\n    is_competency_gap_critical: zod__WEBPACK_IMPORTED_MODULE_0__.z.boolean().default(false),\n    min_score_possible: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().min(0).max(100).default(0),\n    max_score_possible: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().min(0).max(100).default(100)\n}).refine((data)=>data.min_score_possible <= data.max_score_possible, {\n    message: \"Minimum score must be less than or equal to maximum score\"\n});\nconst matrixInputSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    title: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1, \"Title is required\"),\n    description: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    valid_from: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Invalid date format (YYYY-MM-DD)\"),\n    valid_to: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Invalid date format (YYYY-MM-DD)\"),\n    criteria: zod__WEBPACK_IMPORTED_MODULE_0__.z.array(evaluationCriterionSchema).min(1, \"At least one criterion is required\")\n}).refine((data)=>new Date(data.valid_from) <= new Date(data.valid_to), {\n    message: \"Valid from date must be before or equal to valid to date\"\n});\nconst scoreInputSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    criterion_id: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().positive(),\n    achievement_percentage: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().min(0).max(100),\n    manager_criterion_comments: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional()\n});\nconst selfScoreInputsSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    criterion_id: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().positive(),\n    achievement_percentage: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().min(0).max(100),\n    employee_criterion_comments: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional()\n});\nconst evaluationInputSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    matrix_id: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().positive(),\n    employee_id: zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n    evaluation_period_month: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/),\n    status: statusSchema.optional(),\n    manager_overall_comments: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    employee_acknowledgement_comments: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    cancellation_reason: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional()\n});\n// Self-evaluation schemas\nconst selfEvaluationInputSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    matrix_id: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().positive(),\n    evaluation_period_month: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/)\n});\nconst selfEvaluationUpdateSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    status: statusSchema.optional(),\n    employee_overall_comments: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().max(2000).optional(),\n    total_weighted_score: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().min(0).max(100).optional()\n}).refine((data)=>Object.keys(data).length > 0, {\n    message: \"At least one field must be provided for update\"\n});\n// Validation functions\nasync function validateMatrixInput(input) {\n    const errors = [];\n    // Validate title\n    if (!input.title || input.title.trim().length === 0) {\n        errors.push(\"Title is required\");\n    } else if (input.title.length > 255) {\n        errors.push(\"Title must be less than 255 characters\");\n    }\n    // Validate dates\n    if (!input.valid_from) {\n        errors.push(\"Valid from date is required\");\n    } else {\n        const validFrom = new Date(input.valid_from);\n        if (isNaN(validFrom.getTime())) {\n            errors.push(\"Valid from date is invalid\");\n        }\n    }\n    if (!input.valid_to) {\n        errors.push(\"Valid to date is required\");\n    } else {\n        const validTo = new Date(input.valid_to);\n        if (isNaN(validTo.getTime())) {\n            errors.push(\"Valid to date is invalid\");\n        }\n    }\n    if (input.valid_from && input.valid_to) {\n        const validFrom = new Date(input.valid_from);\n        const validTo = new Date(input.valid_to);\n        if (validFrom >= validTo) {\n            errors.push(\"Valid from date must be before valid to date\");\n        }\n    }\n    // Validate status\n    if (input.status && ![\n        \"draft\",\n        \"active\",\n        \"inactive\"\n    ].includes(input.status)) {\n        errors.push(\"Status must be one of: draft, active, inactive\");\n    }\n    // Validate criteria\n    if (!input.criteria || !Array.isArray(input.criteria) || input.criteria.length === 0) {\n        errors.push(\"At least one criterion is required\");\n    } else {\n        let totalWeight = 0;\n        input.criteria.forEach((criterion, index)=>{\n            // Validate criterion name\n            if (!criterion.name || criterion.name.trim().length === 0) {\n                errors.push(`Criterion ${index + 1}: Name is required`);\n            } else if (criterion.name.length > 255) {\n                errors.push(`Criterion ${index + 1}: Name must be less than 255 characters`);\n            }\n            // Validate criterion weight\n            if (typeof criterion.weight !== \"number\" || isNaN(criterion.weight)) {\n                errors.push(`Criterion ${index + 1}: Weight must be a number`);\n            } else if (criterion.weight <= 0) {\n                errors.push(`Criterion ${index + 1}: Weight must be greater than 0`);\n            } else {\n                totalWeight += criterion.weight;\n            }\n            // Validate score range\n            if (criterion.min_score_possible !== undefined) {\n                if (typeof criterion.min_score_possible !== \"number\" || isNaN(criterion.min_score_possible)) {\n                    errors.push(`Criterion ${index + 1}: Minimum score must be a number`);\n                } else if (criterion.min_score_possible < 0) {\n                    errors.push(`Criterion ${index + 1}: Minimum score must be greater than or equal to 0`);\n                }\n            }\n            if (criterion.max_score_possible !== undefined) {\n                if (typeof criterion.max_score_possible !== \"number\" || isNaN(criterion.max_score_possible)) {\n                    errors.push(`Criterion ${index + 1}: Maximum score must be a number`);\n                } else if (criterion.max_score_possible > 100) {\n                    errors.push(`Criterion ${index + 1}: Maximum score must be less than or equal to 100`);\n                }\n            }\n            if (criterion.min_score_possible !== undefined && criterion.max_score_possible !== undefined) {\n                if (criterion.min_score_possible >= criterion.max_score_possible) {\n                    errors.push(`Criterion ${index + 1}: Minimum score must be less than maximum score`);\n                }\n            }\n        });\n        // Validate total weight\n        if (Math.abs(totalWeight - 100) > 0.01) {\n            errors.push(\"Total weight of all criteria must equal 100\");\n        }\n    }\n    // Validate applicable employee IDs\n    if (input.applicable_employee_ids) {\n        if (!Array.isArray(input.applicable_employee_ids)) {\n            errors.push(\"Applicable employee IDs must be an array\");\n        } else if (input.applicable_employee_ids.length === 0) {\n            errors.push(\"At least one applicable employee must be specified\");\n        } else {\n            input.applicable_employee_ids.forEach((id, index)=>{\n                if (!id || typeof id !== \"string\") {\n                    errors.push(`Applicable employee ID at index ${index} is invalid`);\n                }\n            });\n        }\n    }\n    return {\n        success: errors.length === 0,\n        errors: errors.length > 0 ? errors : undefined\n    };\n}\nasync function validateScoreInputs(data) {\n    return zod__WEBPACK_IMPORTED_MODULE_0__.z.array(scoreInputSchema).parse(data);\n}\nasync function validateSelfScoreInputs(input) {\n    try {\n        const validatedData = await selfScoreInputsSchema.parseAsync(input);\n        return {\n            success: true,\n            data: validatedData\n        };\n    } catch (error) {\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodError) {\n            return {\n                success: false,\n                errors: error.errors.map((err)=>({\n                        path: err.path.join(\".\"),\n                        message: err.message\n                    }))\n            };\n        }\n        return {\n            success: false,\n            errors: [\n                {\n                    path: \"\",\n                    message: \"Invalid input format\"\n                }\n            ]\n        };\n    }\n}\nasync function validateEmployeeEvaluationInput(data) {\n    return evaluationInputSchema.parse(data);\n}\nasync function validateSelfEvaluationInput(input) {\n    try {\n        const validatedData = await selfEvaluationInputSchema.parseAsync(input);\n        return {\n            success: true,\n            data: validatedData\n        };\n    } catch (error) {\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodError) {\n            return {\n                success: false,\n                errors: error.errors.map((err)=>({\n                        path: err.path.join(\".\"),\n                        message: err.message\n                    }))\n            };\n        }\n        return {\n            success: false,\n            errors: [\n                {\n                    path: \"\",\n                    message: \"Invalid input format\"\n                }\n            ]\n        };\n    }\n}\n// Status transition validation\nfunction validateStatusTransition(currentStatus, newStatus, userRole, evaluationType) {\n    const validTransitions = {\n        // Self-evaluation transitions\n        self: {\n            employee: {\n                draft: [\n                    \"submitted\"\n                ],\n                submitted: []\n            },\n            admin: {\n                draft: [\n                    \"submitted\"\n                ],\n                submitted: [\n                    \"draft\"\n                ]\n            }\n        },\n        // Employee evaluation transitions\n        employee: {\n            employee: {\n                submitted: [\n                    \"acknowledged\"\n                ]\n            },\n            manager: {\n                draft: [\n                    \"in_progress\",\n                    \"submitted\"\n                ],\n                in_progress: [\n                    \"submitted\"\n                ],\n                submitted: [\n                    \"in_progress\"\n                ]\n            },\n            admin: {\n                draft: [\n                    \"in_progress\",\n                    \"submitted\"\n                ],\n                in_progress: [\n                    \"submitted\",\n                    \"draft\"\n                ],\n                submitted: [\n                    \"in_progress\",\n                    \"draft\",\n                    \"acknowledged\"\n                ],\n                acknowledged: [\n                    \"submitted\",\n                    \"in_progress\",\n                    \"draft\"\n                ]\n            }\n        }\n    };\n    const transitions = validTransitions[evaluationType]?.[userRole]?.[currentStatus] || [];\n    return transitions.includes(newStatus);\n}\n// Date validation helpers\nfunction isValidDateRange(from, to) {\n    const fromDate = new Date(from);\n    const toDate = new Date(to);\n    return fromDate <= toDate;\n}\nfunction isDateInRange(date, from, to) {\n    const checkDate = new Date(date);\n    const fromDate = new Date(from);\n    const toDate = new Date(to);\n    return checkDate >= fromDate && checkDate <= toDate;\n}\n// Score validation helpers\nfunction isValidScoreRange(score, min, max) {\n    return score >= min && score <= max;\n}\nfunction calculateWeightedScore(achievementPercentage, criterionWeight) {\n    const normalizedScore = achievementPercentage / 100;\n    return parseFloat((normalizedScore * criterionWeight).toFixed(2));\n}\n// Helper function to validate weights sum to 100\nfunction validateWeightsSum(weights) {\n    const sum = weights.reduce((acc, weight)=>acc + weight, 0);\n    return Math.abs(sum - 100) < 0.01; // Allow for small floating point differences\n}\n// Helper function to validate evaluation period\nfunction validateEvaluationPeriod(period) {\n    const date = new Date(period);\n    const today = new Date();\n    const oneYearAgo = new Date();\n    oneYearAgo.setFullYear(today.getFullYear() - 1);\n    return date >= oneYearAgo && date <= today;\n}\n// Validation for evaluation updates\nasync function validateEvaluationUpdate(input) {\n    try {\n        const validatedData = await evaluationInputSchema.parseAsync(input);\n        return {\n            success: true,\n            data: validatedData\n        };\n    } catch (error) {\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodError) {\n            return {\n                success: false,\n                errors: error.errors.map((err)=>({\n                        path: err.path.join(\".\"),\n                        message: err.message\n                    }))\n            };\n        }\n        return {\n            success: false,\n            errors: [\n                {\n                    path: \"\",\n                    message: \"Invalid input format\"\n                }\n            ]\n        };\n    }\n}\n// Self-evaluation update validation\nasync function validateSelfEvaluationUpdate(input) {\n    try {\n        const validatedData = await selfEvaluationUpdateSchema.parseAsync(input);\n        return {\n            success: true,\n            data: validatedData\n        };\n    } catch (error) {\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodError) {\n            return {\n                success: false,\n                errors: error.errors.map((err)=>({\n                        path: err.path.join(\".\"),\n                        message: err.message\n                    }))\n            };\n        }\n        return {\n            success: false,\n            errors: [\n                {\n                    path: \"\",\n                    message: \"Invalid input format\"\n                }\n            ]\n        };\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNUbkIsUUFBUTtnQkFBQztvQkFBRTZCLE1BQU07b0JBQUk5RCxTQUFTO2dCQUF1QjthQUFFO1FBQ3pEO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2F6dXJlLWFkLWxvZ2luLWFwcC8uL3NyYy9saWIvZXZhbHVhdGlvbi92YWxpZGF0aW9uLnRzP2M2M2EiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XHJcblxyXG4vLyBCYXNlIHNjaGVtYXMgZm9yIHJldXNlXHJcbmNvbnN0IGRhdGVTY2hlbWEgPSB6LnN0cmluZygpLnJlZ2V4KC9eXFxkezR9LVxcZHsyfS1cXGR7Mn0kLywgJ0RhdGUgbXVzdCBiZSBpbiBZWVlZLU1NLUREIGZvcm1hdCcpO1xyXG5jb25zdCBzdGF0dXNTY2hlbWEgPSB6LmVudW0oWydkcmFmdCcsICdpbl9wcm9ncmVzcycsICdzdWJtaXR0ZWQnLCAndmFsaWRhdGVkJywgJ2NhbmNlbGxlZCcsICdhY2tub3dsZWRnZWQnXSk7XHJcblxyXG4vLyBWYWxpZGF0aW9uIHNjaGVtYXNcclxuY29uc3QgZXZhbHVhdGlvbkNyaXRlcmlvblNjaGVtYSA9IHoub2JqZWN0KHtcclxuICBuYW1lOiB6LnN0cmluZygpLm1pbigxLCAnQ3JpdGVyaW9uIG5hbWUgaXMgcmVxdWlyZWQnKSxcclxuICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxyXG4gIHdlaWdodDogei5udW1iZXIoKS5taW4oMC4wMSkubWF4KDEwMCksXHJcbiAgaXNfY29tcGV0ZW5jeV9nYXBfY3JpdGljYWw6IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxyXG4gIG1pbl9zY29yZV9wb3NzaWJsZTogei5udW1iZXIoKS5taW4oMCkubWF4KDEwMCkuZGVmYXVsdCgwKSxcclxuICBtYXhfc2NvcmVfcG9zc2libGU6IHoubnVtYmVyKCkubWluKDApLm1heCgxMDApLmRlZmF1bHQoMTAwKSxcclxufSkucmVmaW5lKGRhdGEgPT4gZGF0YS5taW5fc2NvcmVfcG9zc2libGUgPD0gZGF0YS5tYXhfc2NvcmVfcG9zc2libGUsIHtcclxuICBtZXNzYWdlOiAnTWluaW11bSBzY29yZSBtdXN0IGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byBtYXhpbXVtIHNjb3JlJ1xyXG59KTtcclxuXHJcbmNvbnN0IG1hdHJpeElucHV0U2NoZW1hID0gei5vYmplY3Qoe1xyXG4gIHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCAnVGl0bGUgaXMgcmVxdWlyZWQnKSxcclxuICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxyXG4gIHZhbGlkX2Zyb206IHouc3RyaW5nKCkucmVnZXgoL15cXGR7NH0tXFxkezJ9LVxcZHsyfSQvLCAnSW52YWxpZCBkYXRlIGZvcm1hdCAoWVlZWS1NTS1ERCknKSxcclxuICB2YWxpZF90bzogei5zdHJpbmcoKS5yZWdleCgvXlxcZHs0fS1cXGR7Mn0tXFxkezJ9JC8sICdJbnZhbGlkIGRhdGUgZm9ybWF0IChZWVlZLU1NLUREKScpLFxyXG4gIGNyaXRlcmlhOiB6LmFycmF5KGV2YWx1YXRpb25Dcml0ZXJpb25TY2hlbWEpLm1pbigxLCAnQXQgbGVhc3Qgb25lIGNyaXRlcmlvbiBpcyByZXF1aXJlZCcpLFxyXG59KS5yZWZpbmUoZGF0YSA9PiBuZXcgRGF0ZShkYXRhLnZhbGlkX2Zyb20pIDw9IG5ldyBEYXRlKGRhdGEudmFsaWRfdG8pLCB7XHJcbiAgbWVzc2FnZTogJ1ZhbGlkIGZyb20gZGF0ZSBtdXN0IGJlIGJlZm9yZSBvciBlcXVhbCB0byB2YWxpZCB0byBkYXRlJ1xyXG59KTtcclxuXHJcbmNvbnN0IHNjb3JlSW5wdXRTY2hlbWEgPSB6Lm9iamVjdCh7XHJcbiAgY3JpdGVyaW9uX2lkOiB6Lm51bWJlcigpLmludCgpLnBvc2l0aXZlKCksXHJcbiAgYWNoaWV2ZW1lbnRfcGVyY2VudGFnZTogei5udW1iZXIoKS5taW4oMCkubWF4KDEwMCksXHJcbiAgbWFuYWdlcl9jcml0ZXJpb25fY29tbWVudHM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcclxufSk7XHJcblxyXG5jb25zdCBzZWxmU2NvcmVJbnB1dHNTY2hlbWEgPSB6Lm9iamVjdCh7XHJcbiAgY3JpdGVyaW9uX2lkOiB6Lm51bWJlcigpLmludCgpLnBvc2l0aXZlKCksXHJcbiAgYWNoaWV2ZW1lbnRfcGVyY2VudGFnZTogei5udW1iZXIoKS5taW4oMCkubWF4KDEwMCksXHJcbiAgZW1wbG95ZWVfY3JpdGVyaW9uX2NvbW1lbnRzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXHJcbn0pO1xyXG5cclxuY29uc3QgZXZhbHVhdGlvbklucHV0U2NoZW1hID0gei5vYmplY3Qoe1xyXG4gIG1hdHJpeF9pZDogei5udW1iZXIoKS5pbnQoKS5wb3NpdGl2ZSgpLFxyXG4gIGVtcGxveWVlX2lkOiB6LnN0cmluZygpLFxyXG4gIGV2YWx1YXRpb25fcGVyaW9kX21vbnRoOiB6LnN0cmluZygpLnJlZ2V4KC9eXFxkezR9LVxcZHsyfS1cXGR7Mn0kLyksXHJcbiAgc3RhdHVzOiBzdGF0dXNTY2hlbWEub3B0aW9uYWwoKSxcclxuICBtYW5hZ2VyX292ZXJhbGxfY29tbWVudHM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcclxuICBlbXBsb3llZV9hY2tub3dsZWRnZW1lbnRfY29tbWVudHM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcclxuICBjYW5jZWxsYXRpb25fcmVhc29uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXHJcbn0pO1xyXG5cclxuLy8gU2VsZi1ldmFsdWF0aW9uIHNjaGVtYXNcclxuY29uc3Qgc2VsZkV2YWx1YXRpb25JbnB1dFNjaGVtYSA9IHoub2JqZWN0KHtcclxuICBtYXRyaXhfaWQ6IHoubnVtYmVyKCkuaW50KCkucG9zaXRpdmUoKSxcclxuICBldmFsdWF0aW9uX3BlcmlvZF9tb250aDogei5zdHJpbmcoKS5yZWdleCgvXlxcZHs0fS1cXGR7Mn0tXFxkezJ9JC8pLFxyXG59KTtcclxuXHJcbmNvbnN0IHNlbGZFdmFsdWF0aW9uVXBkYXRlU2NoZW1hID0gei5vYmplY3Qoe1xyXG4gIHN0YXR1czogc3RhdHVzU2NoZW1hLm9wdGlvbmFsKCksXHJcbiAgZW1wbG95ZWVfb3ZlcmFsbF9jb21tZW50czogei5zdHJpbmcoKS5tYXgoMjAwMCkub3B0aW9uYWwoKSxcclxuICB0b3RhbF93ZWlnaHRlZF9zY29yZTogei5udW1iZXIoKS5taW4oMCkubWF4KDEwMCkub3B0aW9uYWwoKSxcclxufSkucmVmaW5lKGRhdGEgPT4gT2JqZWN0LmtleXMoZGF0YSkubGVuZ3RoID4gMCwge1xyXG4gIG1lc3NhZ2U6ICdBdCBsZWFzdCBvbmUgZmllbGQgbXVzdCBiZSBwcm92aWRlZCBmb3IgdXBkYXRlJ1xyXG59KTtcclxuXHJcbmludGVyZmFjZSBWYWxpZGF0aW9uUmVzdWx0IHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVycm9ycz86IHN0cmluZ1tdO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgTWF0cml4SW5wdXQge1xyXG4gIHRpdGxlOiBzdHJpbmc7XHJcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XHJcbiAgdmFsaWRfZnJvbTogc3RyaW5nO1xyXG4gIHZhbGlkX3RvOiBzdHJpbmc7XHJcbiAgc3RhdHVzPzogc3RyaW5nO1xyXG4gIGNyaXRlcmlhPzogQXJyYXk8e1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XHJcbiAgICB3ZWlnaHQ6IG51bWJlcjtcclxuICAgIGlzX2NvbXBldGVuY3lfZ2FwX2NyaXRpY2FsPzogYm9vbGVhbjtcclxuICAgIG1pbl9zY29yZV9wb3NzaWJsZT86IG51bWJlcjtcclxuICAgIG1heF9zY29yZV9wb3NzaWJsZT86IG51bWJlcjtcclxuICB9PjtcclxuICBhcHBsaWNhYmxlX2VtcGxveWVlX2lkcz86IHN0cmluZ1tdO1xyXG59XHJcblxyXG4vLyBWYWxpZGF0aW9uIGZ1bmN0aW9uc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVNYXRyaXhJbnB1dChpbnB1dDogTWF0cml4SW5wdXQpOiBQcm9taXNlPFZhbGlkYXRpb25SZXN1bHQ+IHtcclxuICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XHJcblxyXG4gIC8vIFZhbGlkYXRlIHRpdGxlXHJcbiAgaWYgKCFpbnB1dC50aXRsZSB8fCBpbnB1dC50aXRsZS50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICBlcnJvcnMucHVzaCgnVGl0bGUgaXMgcmVxdWlyZWQnKTtcclxuICB9IGVsc2UgaWYgKGlucHV0LnRpdGxlLmxlbmd0aCA+IDI1NSkge1xyXG4gICAgZXJyb3JzLnB1c2goJ1RpdGxlIG11c3QgYmUgbGVzcyB0aGFuIDI1NSBjaGFyYWN0ZXJzJyk7XHJcbiAgfVxyXG5cclxuICAvLyBWYWxpZGF0ZSBkYXRlc1xyXG4gIGlmICghaW5wdXQudmFsaWRfZnJvbSkge1xyXG4gICAgZXJyb3JzLnB1c2goJ1ZhbGlkIGZyb20gZGF0ZSBpcyByZXF1aXJlZCcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCB2YWxpZEZyb20gPSBuZXcgRGF0ZShpbnB1dC52YWxpZF9mcm9tKTtcclxuICAgIGlmIChpc05hTih2YWxpZEZyb20uZ2V0VGltZSgpKSkge1xyXG4gICAgICBlcnJvcnMucHVzaCgnVmFsaWQgZnJvbSBkYXRlIGlzIGludmFsaWQnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmICghaW5wdXQudmFsaWRfdG8pIHtcclxuICAgIGVycm9ycy5wdXNoKCdWYWxpZCB0byBkYXRlIGlzIHJlcXVpcmVkJyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnN0IHZhbGlkVG8gPSBuZXcgRGF0ZShpbnB1dC52YWxpZF90byk7XHJcbiAgICBpZiAoaXNOYU4odmFsaWRUby5nZXRUaW1lKCkpKSB7XHJcbiAgICAgIGVycm9ycy5wdXNoKCdWYWxpZCB0byBkYXRlIGlzIGludmFsaWQnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmIChpbnB1dC52YWxpZF9mcm9tICYmIGlucHV0LnZhbGlkX3RvKSB7XHJcbiAgICBjb25zdCB2YWxpZEZyb20gPSBuZXcgRGF0ZShpbnB1dC52YWxpZF9mcm9tKTtcclxuICAgIGNvbnN0IHZhbGlkVG8gPSBuZXcgRGF0ZShpbnB1dC52YWxpZF90byk7XHJcbiAgICBpZiAodmFsaWRGcm9tID49IHZhbGlkVG8pIHtcclxuICAgICAgZXJyb3JzLnB1c2goJ1ZhbGlkIGZyb20gZGF0ZSBtdXN0IGJlIGJlZm9yZSB2YWxpZCB0byBkYXRlJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBWYWxpZGF0ZSBzdGF0dXNcclxuICBpZiAoaW5wdXQuc3RhdHVzICYmICFbJ2RyYWZ0JywgJ2FjdGl2ZScsICdpbmFjdGl2ZSddLmluY2x1ZGVzKGlucHV0LnN0YXR1cykpIHtcclxuICAgIGVycm9ycy5wdXNoKCdTdGF0dXMgbXVzdCBiZSBvbmUgb2Y6IGRyYWZ0LCBhY3RpdmUsIGluYWN0aXZlJyk7XHJcbiAgfVxyXG5cclxuICAvLyBWYWxpZGF0ZSBjcml0ZXJpYVxyXG4gIGlmICghaW5wdXQuY3JpdGVyaWEgfHwgIUFycmF5LmlzQXJyYXkoaW5wdXQuY3JpdGVyaWEpIHx8IGlucHV0LmNyaXRlcmlhLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgZXJyb3JzLnB1c2goJ0F0IGxlYXN0IG9uZSBjcml0ZXJpb24gaXMgcmVxdWlyZWQnKTtcclxuICB9IGVsc2Uge1xyXG4gICAgbGV0IHRvdGFsV2VpZ2h0ID0gMDtcclxuICAgIGlucHV0LmNyaXRlcmlhLmZvckVhY2goKGNyaXRlcmlvbiwgaW5kZXgpID0+IHtcclxuICAgICAgLy8gVmFsaWRhdGUgY3JpdGVyaW9uIG5hbWVcclxuICAgICAgaWYgKCFjcml0ZXJpb24ubmFtZSB8fCBjcml0ZXJpb24ubmFtZS50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgZXJyb3JzLnB1c2goYENyaXRlcmlvbiAke2luZGV4ICsgMX06IE5hbWUgaXMgcmVxdWlyZWRgKTtcclxuICAgICAgfSBlbHNlIGlmIChjcml0ZXJpb24ubmFtZS5sZW5ndGggPiAyNTUpIHtcclxuICAgICAgICBlcnJvcnMucHVzaChgQ3JpdGVyaW9uICR7aW5kZXggKyAxfTogTmFtZSBtdXN0IGJlIGxlc3MgdGhhbiAyNTUgY2hhcmFjdGVyc2ApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBWYWxpZGF0ZSBjcml0ZXJpb24gd2VpZ2h0XHJcbiAgICAgIGlmICh0eXBlb2YgY3JpdGVyaW9uLndlaWdodCAhPT0gJ251bWJlcicgfHwgaXNOYU4oY3JpdGVyaW9uLndlaWdodCkpIHtcclxuICAgICAgICBlcnJvcnMucHVzaChgQ3JpdGVyaW9uICR7aW5kZXggKyAxfTogV2VpZ2h0IG11c3QgYmUgYSBudW1iZXJgKTtcclxuICAgICAgfSBlbHNlIGlmIChjcml0ZXJpb24ud2VpZ2h0IDw9IDApIHtcclxuICAgICAgICBlcnJvcnMucHVzaChgQ3JpdGVyaW9uICR7aW5kZXggKyAxfTogV2VpZ2h0IG11c3QgYmUgZ3JlYXRlciB0aGFuIDBgKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0b3RhbFdlaWdodCArPSBjcml0ZXJpb24ud2VpZ2h0O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBWYWxpZGF0ZSBzY29yZSByYW5nZVxyXG4gICAgICBpZiAoY3JpdGVyaW9uLm1pbl9zY29yZV9wb3NzaWJsZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjcml0ZXJpb24ubWluX3Njb3JlX3Bvc3NpYmxlICE9PSAnbnVtYmVyJyB8fCBpc05hTihjcml0ZXJpb24ubWluX3Njb3JlX3Bvc3NpYmxlKSkge1xyXG4gICAgICAgICAgZXJyb3JzLnB1c2goYENyaXRlcmlvbiAke2luZGV4ICsgMX06IE1pbmltdW0gc2NvcmUgbXVzdCBiZSBhIG51bWJlcmApO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoY3JpdGVyaW9uLm1pbl9zY29yZV9wb3NzaWJsZSA8IDApIHtcclxuICAgICAgICAgIGVycm9ycy5wdXNoKGBDcml0ZXJpb24gJHtpbmRleCArIDF9OiBNaW5pbXVtIHNjb3JlIG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDBgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjcml0ZXJpb24ubWF4X3Njb3JlX3Bvc3NpYmxlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGNyaXRlcmlvbi5tYXhfc2NvcmVfcG9zc2libGUgIT09ICdudW1iZXInIHx8IGlzTmFOKGNyaXRlcmlvbi5tYXhfc2NvcmVfcG9zc2libGUpKSB7XHJcbiAgICAgICAgICBlcnJvcnMucHVzaChgQ3JpdGVyaW9uICR7aW5kZXggKyAxfTogTWF4aW11bSBzY29yZSBtdXN0IGJlIGEgbnVtYmVyYCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChjcml0ZXJpb24ubWF4X3Njb3JlX3Bvc3NpYmxlID4gMTAwKSB7XHJcbiAgICAgICAgICBlcnJvcnMucHVzaChgQ3JpdGVyaW9uICR7aW5kZXggKyAxfTogTWF4aW11bSBzY29yZSBtdXN0IGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byAxMDBgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjcml0ZXJpb24ubWluX3Njb3JlX3Bvc3NpYmxlICE9PSB1bmRlZmluZWQgJiYgY3JpdGVyaW9uLm1heF9zY29yZV9wb3NzaWJsZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgaWYgKGNyaXRlcmlvbi5taW5fc2NvcmVfcG9zc2libGUgPj0gY3JpdGVyaW9uLm1heF9zY29yZV9wb3NzaWJsZSkge1xyXG4gICAgICAgICAgZXJyb3JzLnB1c2goYENyaXRlcmlvbiAke2luZGV4ICsgMX06IE1pbmltdW0gc2NvcmUgbXVzdCBiZSBsZXNzIHRoYW4gbWF4aW11bSBzY29yZWApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgdG90YWwgd2VpZ2h0XHJcbiAgICBpZiAoTWF0aC5hYnModG90YWxXZWlnaHQgLSAxMDApID4gMC4wMSkge1xyXG4gICAgICBlcnJvcnMucHVzaCgnVG90YWwgd2VpZ2h0IG9mIGFsbCBjcml0ZXJpYSBtdXN0IGVxdWFsIDEwMCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gVmFsaWRhdGUgYXBwbGljYWJsZSBlbXBsb3llZSBJRHNcclxuICBpZiAoaW5wdXQuYXBwbGljYWJsZV9lbXBsb3llZV9pZHMpIHtcclxuICAgIGlmICghQXJyYXkuaXNBcnJheShpbnB1dC5hcHBsaWNhYmxlX2VtcGxveWVlX2lkcykpIHtcclxuICAgICAgZXJyb3JzLnB1c2goJ0FwcGxpY2FibGUgZW1wbG95ZWUgSURzIG11c3QgYmUgYW4gYXJyYXknKTtcclxuICAgIH0gZWxzZSBpZiAoaW5wdXQuYXBwbGljYWJsZV9lbXBsb3llZV9pZHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGVycm9ycy5wdXNoKCdBdCBsZWFzdCBvbmUgYXBwbGljYWJsZSBlbXBsb3llZSBtdXN0IGJlIHNwZWNpZmllZCcpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaW5wdXQuYXBwbGljYWJsZV9lbXBsb3llZV9pZHMuZm9yRWFjaCgoaWQsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYgKCFpZCB8fCB0eXBlb2YgaWQgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICBlcnJvcnMucHVzaChgQXBwbGljYWJsZSBlbXBsb3llZSBJRCBhdCBpbmRleCAke2luZGV4fSBpcyBpbnZhbGlkYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBzdWNjZXNzOiBlcnJvcnMubGVuZ3RoID09PSAwLFxyXG4gICAgZXJyb3JzOiBlcnJvcnMubGVuZ3RoID4gMCA/IGVycm9ycyA6IHVuZGVmaW5lZFxyXG4gIH07XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZVNjb3JlSW5wdXRzKGRhdGE6IHVua25vd24pIHtcclxuICByZXR1cm4gei5hcnJheShzY29yZUlucHV0U2NoZW1hKS5wYXJzZShkYXRhKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlU2VsZlNjb3JlSW5wdXRzKGlucHV0OiB1bmtub3duKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBhd2FpdCBzZWxmU2NvcmVJbnB1dHNTY2hlbWEucGFyc2VBc3luYyhpbnB1dCk7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB2YWxpZGF0ZWREYXRhIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycy5tYXAoZXJyID0+ICh7XHJcbiAgICAgICAgICBwYXRoOiBlcnIucGF0aC5qb2luKCcuJyksXHJcbiAgICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yczogW3sgcGF0aDogJycsIG1lc3NhZ2U6ICdJbnZhbGlkIGlucHV0IGZvcm1hdCcgfV1cclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVFbXBsb3llZUV2YWx1YXRpb25JbnB1dChkYXRhOiB1bmtub3duKSB7XHJcbiAgcmV0dXJuIGV2YWx1YXRpb25JbnB1dFNjaGVtYS5wYXJzZShkYXRhKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlU2VsZkV2YWx1YXRpb25JbnB1dChpbnB1dDogdW5rbm93bikge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gYXdhaXQgc2VsZkV2YWx1YXRpb25JbnB1dFNjaGVtYS5wYXJzZUFzeW5jKGlucHV0KTtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHZhbGlkYXRlZERhdGEgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLm1hcChlcnIgPT4gKHtcclxuICAgICAgICAgIHBhdGg6IGVyci5wYXRoLmpvaW4oJy4nKSxcclxuICAgICAgICAgIG1lc3NhZ2U6IGVyci5tZXNzYWdlXHJcbiAgICAgICAgfSkpXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3JzOiBbeyBwYXRoOiAnJywgbWVzc2FnZTogJ0ludmFsaWQgaW5wdXQgZm9ybWF0JyB9XVxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbi8vIFN0YXR1cyB0cmFuc2l0aW9uIHZhbGlkYXRpb25cclxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlU3RhdHVzVHJhbnNpdGlvbihcclxuICBjdXJyZW50U3RhdHVzOiBzdHJpbmcsXHJcbiAgbmV3U3RhdHVzOiBzdHJpbmcsXHJcbiAgdXNlclJvbGU6ICdlbXBsb3llZScgfCAnbWFuYWdlcicgfCAnYWRtaW4nLFxyXG4gIGV2YWx1YXRpb25UeXBlOiAnc2VsZicgfCAnZW1wbG95ZWUnXHJcbik6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IHZhbGlkVHJhbnNpdGlvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcclxuICAgIC8vIFNlbGYtZXZhbHVhdGlvbiB0cmFuc2l0aW9uc1xyXG4gICAgc2VsZjoge1xyXG4gICAgICBlbXBsb3llZToge1xyXG4gICAgICAgIGRyYWZ0OiBbJ3N1Ym1pdHRlZCddLFxyXG4gICAgICAgIHN1Ym1pdHRlZDogW10sIC8vIE9uY2Ugc3VibWl0dGVkLCBubyBmdXJ0aGVyIHRyYW5zaXRpb25zIGFsbG93ZWRcclxuICAgICAgfSxcclxuICAgICAgYWRtaW46IHtcclxuICAgICAgICBkcmFmdDogWydzdWJtaXR0ZWQnXSxcclxuICAgICAgICBzdWJtaXR0ZWQ6IFsnZHJhZnQnXSwgLy8gQWRtaW4gY2FuIHJldmVydCB0byBkcmFmdCBpZiBuZWVkZWRcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIC8vIEVtcGxveWVlIGV2YWx1YXRpb24gdHJhbnNpdGlvbnNcclxuICAgIGVtcGxveWVlOiB7XHJcbiAgICAgIGVtcGxveWVlOiB7XHJcbiAgICAgICAgc3VibWl0dGVkOiBbJ2Fja25vd2xlZGdlZCddLCAvLyBFbXBsb3llZSBjYW4gb25seSBhY2tub3dsZWRnZVxyXG4gICAgICB9LFxyXG4gICAgICBtYW5hZ2VyOiB7XHJcbiAgICAgICAgZHJhZnQ6IFsnaW5fcHJvZ3Jlc3MnLCAnc3VibWl0dGVkJ10sXHJcbiAgICAgICAgaW5fcHJvZ3Jlc3M6IFsnc3VibWl0dGVkJ10sXHJcbiAgICAgICAgc3VibWl0dGVkOiBbJ2luX3Byb2dyZXNzJ10sIC8vIE1hbmFnZXIgY2FuIHJldmVydCB0byBpbl9wcm9ncmVzc1xyXG4gICAgICB9LFxyXG4gICAgICBhZG1pbjoge1xyXG4gICAgICAgIGRyYWZ0OiBbJ2luX3Byb2dyZXNzJywgJ3N1Ym1pdHRlZCddLFxyXG4gICAgICAgIGluX3Byb2dyZXNzOiBbJ3N1Ym1pdHRlZCcsICdkcmFmdCddLFxyXG4gICAgICAgIHN1Ym1pdHRlZDogWydpbl9wcm9ncmVzcycsICdkcmFmdCcsICdhY2tub3dsZWRnZWQnXSxcclxuICAgICAgICBhY2tub3dsZWRnZWQ6IFsnc3VibWl0dGVkJywgJ2luX3Byb2dyZXNzJywgJ2RyYWZ0J10sXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCB0cmFuc2l0aW9ucyA9IHZhbGlkVHJhbnNpdGlvbnNbZXZhbHVhdGlvblR5cGVdPy5bdXNlclJvbGVdPy5bY3VycmVudFN0YXR1c10gfHwgW107XHJcbiAgcmV0dXJuIHRyYW5zaXRpb25zLmluY2x1ZGVzKG5ld1N0YXR1cyk7XHJcbn1cclxuXHJcbi8vIERhdGUgdmFsaWRhdGlvbiBoZWxwZXJzXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkRGF0ZVJhbmdlKGZyb206IHN0cmluZywgdG86IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IGZyb21EYXRlID0gbmV3IERhdGUoZnJvbSk7XHJcbiAgY29uc3QgdG9EYXRlID0gbmV3IERhdGUodG8pO1xyXG4gIHJldHVybiBmcm9tRGF0ZSA8PSB0b0RhdGU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0RhdGVJblJhbmdlKGRhdGU6IHN0cmluZywgZnJvbTogc3RyaW5nLCB0bzogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgY29uc3QgY2hlY2tEYXRlID0gbmV3IERhdGUoZGF0ZSk7XHJcbiAgY29uc3QgZnJvbURhdGUgPSBuZXcgRGF0ZShmcm9tKTtcclxuICBjb25zdCB0b0RhdGUgPSBuZXcgRGF0ZSh0byk7XHJcbiAgcmV0dXJuIGNoZWNrRGF0ZSA+PSBmcm9tRGF0ZSAmJiBjaGVja0RhdGUgPD0gdG9EYXRlO1xyXG59XHJcblxyXG4vLyBTY29yZSB2YWxpZGF0aW9uIGhlbHBlcnNcclxuZXhwb3J0IGZ1bmN0aW9uIGlzVmFsaWRTY29yZVJhbmdlKHNjb3JlOiBudW1iZXIsIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gIHJldHVybiBzY29yZSA+PSBtaW4gJiYgc2NvcmUgPD0gbWF4O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlV2VpZ2h0ZWRTY29yZShcclxuICBhY2hpZXZlbWVudFBlcmNlbnRhZ2U6IG51bWJlcixcclxuICBjcml0ZXJpb25XZWlnaHQ6IG51bWJlclxyXG4pOiBudW1iZXIge1xyXG4gIGNvbnN0IG5vcm1hbGl6ZWRTY29yZSA9IGFjaGlldmVtZW50UGVyY2VudGFnZSAvIDEwMDtcclxuICByZXR1cm4gcGFyc2VGbG9hdCgobm9ybWFsaXplZFNjb3JlICogY3JpdGVyaW9uV2VpZ2h0KS50b0ZpeGVkKDIpKTtcclxufVxyXG5cclxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIHdlaWdodHMgc3VtIHRvIDEwMFxyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVXZWlnaHRzU3VtKHdlaWdodHM6IG51bWJlcltdKTogYm9vbGVhbiB7XHJcbiAgY29uc3Qgc3VtID0gd2VpZ2h0cy5yZWR1Y2UoKGFjYywgd2VpZ2h0KSA9PiBhY2MgKyB3ZWlnaHQsIDApO1xyXG4gIHJldHVybiBNYXRoLmFicyhzdW0gLSAxMDApIDwgMC4wMTsgLy8gQWxsb3cgZm9yIHNtYWxsIGZsb2F0aW5nIHBvaW50IGRpZmZlcmVuY2VzXHJcbn1cclxuXHJcbi8vIEhlbHBlciBmdW5jdGlvbiB0byB2YWxpZGF0ZSBldmFsdWF0aW9uIHBlcmlvZFxyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVFdmFsdWF0aW9uUGVyaW9kKHBlcmlvZDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHBlcmlvZCk7XHJcbiAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xyXG4gIGNvbnN0IG9uZVllYXJBZ28gPSBuZXcgRGF0ZSgpO1xyXG4gIG9uZVllYXJBZ28uc2V0RnVsbFllYXIodG9kYXkuZ2V0RnVsbFllYXIoKSAtIDEpO1xyXG4gIFxyXG4gIHJldHVybiBkYXRlID49IG9uZVllYXJBZ28gJiYgZGF0ZSA8PSB0b2RheTtcclxufVxyXG5cclxuLy8gVmFsaWRhdGlvbiBmb3IgZXZhbHVhdGlvbiB1cGRhdGVzXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUV2YWx1YXRpb25VcGRhdGUoaW5wdXQ6IHVua25vd24pIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGF3YWl0IGV2YWx1YXRpb25JbnB1dFNjaGVtYS5wYXJzZUFzeW5jKGlucHV0KTtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHZhbGlkYXRlZERhdGEgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLm1hcChlcnIgPT4gKHtcclxuICAgICAgICAgIHBhdGg6IGVyci5wYXRoLmpvaW4oJy4nKSxcclxuICAgICAgICAgIG1lc3NhZ2U6IGVyci5tZXNzYWdlXHJcbiAgICAgICAgfSkpXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3JzOiBbeyBwYXRoOiAnJywgbWVzc2FnZTogJ0ludmFsaWQgaW5wdXQgZm9ybWF0JyB9XVxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbi8vIFNlbGYtZXZhbHVhdGlvbiB1cGRhdGUgdmFsaWRhdGlvblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVTZWxmRXZhbHVhdGlvblVwZGF0ZShpbnB1dDogdW5rbm93bikge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gYXdhaXQgc2VsZkV2YWx1YXRpb25VcGRhdGVTY2hlbWEucGFyc2VBc3luYyhpbnB1dCk7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB2YWxpZGF0ZWREYXRhIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycy5tYXAoZXJyID0+ICh7XHJcbiAgICAgICAgICBwYXRoOiBlcnIucGF0aC5qb2luKCcuJyksXHJcbiAgICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yczogW3sgcGF0aDogJycsIG1lc3NhZ2U6ICdJbnZhbGlkIGlucHV0IGZvcm1hdCcgfV1cclxuICAgIH07XHJcbiAgfVxyXG59ICJdLCJuYW1lcyI6WyJ6IiwiZGF0ZVNjaGVtYSIsInN0cmluZyIsInJlZ2V4Iiwic3RhdHVzU2NoZW1hIiwiZW51bSIsImV2YWx1YXRpb25Dcml0ZXJpb25TY2hlbWEiLCJvYmplY3QiLCJuYW1lIiwibWluIiwiZGVzY3JpcHRpb24iLCJvcHRpb25hbCIsIndlaWdodCIsIm51bWJlciIsIm1heCIsImlzX2NvbXBldGVuY3lfZ2FwX2NyaXRpY2FsIiwiYm9vbGVhbiIsImRlZmF1bHQiLCJtaW5fc2NvcmVfcG9zc2libGUiLCJtYXhfc2NvcmVfcG9zc2libGUiLCJyZWZpbmUiLCJkYXRhIiwibWVzc2FnZSIsIm1hdHJpeElucHV0U2NoZW1hIiwidGl0bGUiLCJ2YWxpZF9mcm9tIiwidmFsaWRfdG8iLCJjcml0ZXJpYSIsImFycmF5IiwiRGF0ZSIsInNjb3JlSW5wdXRTY2hlbWEiLCJjcml0ZXJpb25faWQiLCJpbnQiLCJwb3NpdGl2ZSIsImFjaGlldmVtZW50X3BlcmNlbnRhZ2UiLCJtYW5hZ2VyX2NyaXRlcmlvbl9jb21tZW50cyIsInNlbGZTY29yZUlucHV0c1NjaGVtYSIsImVtcGxveWVlX2NyaXRlcmlvbl9jb21tZW50cyIsImV2YWx1YXRpb25JbnB1dFNjaGVtYSIsIm1hdHJpeF9pZCIsImVtcGxveWVlX2lkIiwiZXZhbHVhdGlvbl9wZXJpb2RfbW9udGgiLCJzdGF0dXMiLCJtYW5hZ2VyX292ZXJhbGxfY29tbWVudHMiLCJlbXBsb3llZV9hY2tub3dsZWRnZW1lbnRfY29tbWVudHMiLCJjYW5jZWxsYXRpb25fcmVhc29uIiwic2VsZkV2YWx1YXRpb25JbnB1dFNjaGVtYSIsInNlbGZFdmFsdWF0aW9uVXBkYXRlU2NoZW1hIiwiZW1wbG95ZWVfb3ZlcmFsbF9jb21tZW50cyIsInRvdGFsX3dlaWdodGVkX3Njb3JlIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsInZhbGlkYXRlTWF0cml4SW5wdXQiLCJpbnB1dCIsImVycm9ycyIsInRyaW0iLCJwdXNoIiwidmFsaWRGcm9tIiwiaXNOYU4iLCJnZXRUaW1lIiwidmFsaWRUbyIsImluY2x1ZGVzIiwiQXJyYXkiLCJpc0FycmF5IiwidG90YWxXZWlnaHQiLCJmb3JFYWNoIiwiY3JpdGVyaW9uIiwiaW5kZXgiLCJ1bmRlZmluZWQiLCJNYXRoIiwiYWJzIiwiYXBwbGljYWJsZV9lbXBsb3llZV9pZHMiLCJpZCIsInN1Y2Nlc3MiLCJ2YWxpZGF0ZVNjb3JlSW5wdXRzIiwicGFyc2UiLCJ2YWxpZGF0ZVNlbGZTY29yZUlucHV0cyIsInZhbGlkYXRlZERhdGEiLCJwYXJzZUFzeW5jIiwiZXJyb3IiLCJab2RFcnJvciIsIm1hcCIsImVyciIsInBhdGgiLCJqb2luIiwidmFsaWRhdGVFbXBsb3llZUV2YWx1YXRpb25JbnB1dCIsInZhbGlkYXRlU2VsZkV2YWx1YXRpb25JbnB1dCIsInZhbGlkYXRlU3RhdHVzVHJhbnNpdGlvbiIsImN1cnJlbnRTdGF0dXMiLCJuZXdTdGF0dXMiLCJ1c2VyUm9sZSIsImV2YWx1YXRpb25UeXBlIiwidmFsaWRUcmFuc2l0aW9ucyIsInNlbGYiLCJlbXBsb3llZSIsImRyYWZ0Iiwic3VibWl0dGVkIiwiYWRtaW4iLCJtYW5hZ2VyIiwiaW5fcHJvZ3Jlc3MiLCJhY2tub3dsZWRnZWQiLCJ0cmFuc2l0aW9ucyIsImlzVmFsaWREYXRlUmFuZ2UiLCJmcm9tIiwidG8iLCJmcm9tRGF0ZSIsInRvRGF0ZSIsImlzRGF0ZUluUmFuZ2UiLCJkYXRlIiwiY2hlY2tEYXRlIiwiaXNWYWxpZFNjb3JlUmFuZ2UiLCJzY29yZSIsImNhbGN1bGF0ZVdlaWdodGVkU2NvcmUiLCJhY2hpZXZlbWVudFBlcmNlbnRhZ2UiLCJjcml0ZXJpb25XZWlnaHQiLCJub3JtYWxpemVkU2NvcmUiLCJwYXJzZUZsb2F0IiwidG9GaXhlZCIsInZhbGlkYXRlV2VpZ2h0c1N1bSIsIndlaWdodHMiLCJzdW0iLCJyZWR1Y2UiLCJhY2MiLCJ2YWxpZGF0ZUV2YWx1YXRpb25QZXJpb2QiLCJwZXJpb2QiLCJ0b2RheSIsIm9uZVllYXJBZ28iLCJzZXRGdWxsWWVhciIsImdldEZ1bGxZZWFyIiwidmFsaWRhdGVFdmFsdWF0aW9uVXBkYXRlIiwidmFsaWRhdGVTZWxmRXZhbHVhdGlvblVwZGF0ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/evaluation/validation.ts\n");

/***/ }),

/***/ "(api)/./src/middleware/auth.ts":
/*!********************************!*\
  !*** ./src/middleware/auth.ts ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getUserDirectReports: () => (/* binding */ getUserDirectReports),\n/* harmony export */   getUserManager: () => (/* binding */ getUserManager),\n/* harmony export */   hasAnyRole: () => (/* binding */ hasAnyRole),\n/* harmony export */   hasRole: () => (/* binding */ hasRole),\n/* harmony export */   isAdmin: () => (/* binding */ isAdmin),\n/* harmony export */   isManager: () => (/* binding */ isManager),\n/* harmony export */   isSelfAccess: () => (/* binding */ isSelfAccess),\n/* harmony export */   withAuth: () => (/* binding */ withAuth)\n/* harmony export */ });\n/* harmony import */ var _azure_msal_browser__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/msal-browser */ \"@azure/msal-browser\");\n/* harmony import */ var _azure_msal_node__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @azure/msal-node */ \"@azure/msal-node\");\n/* harmony import */ var _lib_db_pool__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/db/pool */ \"(api)/./src/lib/db/pool.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_azure_msal_browser__WEBPACK_IMPORTED_MODULE_0__, _azure_msal_node__WEBPACK_IMPORTED_MODULE_1__]);\n([_azure_msal_browser__WEBPACK_IMPORTED_MODULE_0__, _azure_msal_node__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n// MSAL configuration\nconst msalConfig = {\n    auth: {\n        clientId: process.env.AZURE_AD_CLIENT_ID,\n        authority: `https://login.microsoftonline.com/${process.env.AZURE_AD_TENANT_ID}`,\n        redirectUri: process.env.AZURE_AD_REDIRECT_URI,\n        clientSecret: process.env.AZURE_AD_CLIENT_SECRET\n    },\n    cache: {\n        cacheLocation: \"localStorage\",\n        storeAuthStateInCookie: false\n    }\n};\n// MSAL Node configuration for client credentials\nconst msalNodeConfig = {\n    auth: {\n        clientId: process.env.AZURE_AD_CLIENT_ID,\n        authority: `https://login.microsoftonline.com/${process.env.AZURE_AD_TENANT_ID}`,\n        clientSecret: process.env.AZURE_AD_CLIENT_SECRET\n    }\n};\n// Validate MSAL configuration\nfunction validateMsalConfig() {\n    const requiredVars = {\n        AZURE_AD_CLIENT_ID: process.env.AZURE_AD_CLIENT_ID,\n        AZURE_AD_TENANT_ID: process.env.AZURE_AD_TENANT_ID,\n        AZURE_AD_REDIRECT_URI: process.env.AZURE_AD_REDIRECT_URI,\n        AZURE_AD_CLIENT_SECRET: process.env.AZURE_AD_CLIENT_SECRET\n    };\n    const missingVars = Object.entries(requiredVars).filter(([_, value])=>!value).map(([key])=>key);\n    if (missingVars.length > 0) {\n        console.error(\"Missing required Azure AD configuration:\", {\n            missing: missingVars,\n            config: {\n                ...requiredVars,\n                AZURE_AD_CLIENT_SECRET: requiredVars.AZURE_AD_CLIENT_SECRET ? \"[REDACTED]\" : undefined\n            }\n        });\n        throw new Error(`Missing required Azure AD configuration: ${missingVars.join(\", \")}`);\n    }\n}\n// Initialize MSAL instances\nlet msalInstance;\nlet confidentialClient;\ntry {\n    validateMsalConfig();\n    msalInstance = new _azure_msal_browser__WEBPACK_IMPORTED_MODULE_0__.PublicClientApplication(msalConfig);\n    confidentialClient = new _azure_msal_node__WEBPACK_IMPORTED_MODULE_1__.ConfidentialClientApplication(msalNodeConfig);\n    console.log(\"MSAL instances initialized successfully\");\n} catch (error) {\n    console.error(\"Failed to initialize MSAL:\", error);\n    throw error;\n}\n// Cache for Graph API token\nlet graphTokenCache = null;\n// Helper to get Graph API token using client credentials\nasync function getGraphApiToken() {\n    // Check if we have a valid cached token\n    if (graphTokenCache && graphTokenCache.expiresAt > Date.now() + 60000) {\n        return graphTokenCache.token;\n    }\n    try {\n        const result = await confidentialClient.acquireTokenByClientCredential({\n            scopes: [\n                process.env.AZURE_AD_GRAPH_SCOPE || \"https://graph.microsoft.com/.default\"\n            ]\n        });\n        if (!result?.accessToken) {\n            throw new Error(\"Failed to acquire Graph API token\");\n        }\n        // Cache the token\n        graphTokenCache = {\n            token: result.accessToken,\n            expiresAt: Date.now() + (result.expiresIn || 3600) * 1000\n        };\n        return result.accessToken;\n    } catch (error) {\n        console.error(\"Error acquiring Graph API token:\", error);\n        throw error;\n    }\n}\n// Helper to validate user token\nasync function validateUserToken(token) {\n    console.log(\"\\uD83D\\uDD10 Validating token against Microsoft Graph...\");\n    try {\n        // Get Graph API token using client credentials\n        const graphToken = await getGraphApiToken();\n        // Decode the user token to get the user ID\n        const decodedToken = JSON.parse(Buffer.from(token.split(\".\")[1], \"base64\").toString());\n        const userId = decodedToken.oid || decodedToken.sub;\n        if (!userId) {\n            console.error(\"Could not extract user ID from token\");\n            return null;\n        }\n        // Use the Graph API token to get user info\n        const response = await fetch(`https://graph.microsoft.com/v1.0/users/${userId}`, {\n            headers: {\n                Authorization: `Bearer ${graphToken}`,\n                \"Content-Type\": \"application/json\"\n            }\n        });\n        if (!response.ok) {\n            const body = await response.text();\n            console.error(\" Microsoft Graph API error:\", {\n                status: response.status,\n                statusText: response.statusText,\n                error: body\n            });\n            return null;\n        }\n        const user = await response.json();\n        console.log(\" Microsoft Graph user info:\", user);\n        if (!user || !user.userPrincipalName) {\n            console.error(\"Could not extract userPrincipalName from Graph API response for user ID:\", userId);\n            return null;\n        }\n        // Get user roles from Microsoft Graph groups\n        const groupsResponse = await fetch(`https://graph.microsoft.com/v1.0/users/${userId}/memberOf`, {\n            headers: {\n                Authorization: `Bearer ${graphToken}`,\n                \"Content-Type\": \"application/json\"\n            }\n        });\n        if (!groupsResponse.ok) {\n            console.warn(\"Could not fetch user groups from Microsoft Graph\");\n            return {\n                id: user.userPrincipalName,\n                roles: []\n            };\n        }\n        const groups = await groupsResponse.json();\n        const roles = groups.value.filter((group)=>group[\"@odata.type\"] === \"#microsoft.graph.group\").map((group)=>group.displayName.toLowerCase());\n        console.log(\"User roles from Microsoft Graph:\", roles);\n        return {\n            id: user.userPrincipalName,\n            roles: roles\n        };\n    } catch (error) {\n        console.error(\"Token validation error:\", {\n            error: error instanceof Error ? error.message : \"Unknown error\",\n            stack: error instanceof Error ? error.stack : undefined\n        });\n        return null;\n    }\n}\n// Helper to get user's manager from Microsoft Graph\nasync function getUserManager(token) {\n    try {\n        const graphToken = await getGraphApiToken();\n        // Decode the user token to get the user ID\n        const decodedToken = JSON.parse(Buffer.from(token.split(\".\")[1], \"base64\").toString());\n        const userId = decodedToken.oid || decodedToken.sub;\n        if (!userId) {\n            console.error(\"Could not extract user ID from token\");\n            return null;\n        }\n        const response = await fetch(`https://graph.microsoft.com/v1.0/users/${userId}/manager`, {\n            headers: {\n                Authorization: `Bearer ${graphToken}`,\n                \"Content-Type\": \"application/json\"\n            }\n        });\n        if (!response.ok) {\n            const body = await response.text();\n            console.error(\" Error fetching manager:\", {\n                status: response.status,\n                statusText: response.statusText,\n                error: body\n            });\n            return null;\n        }\n        return await response.json();\n    } catch (error) {\n        console.error(\"Error fetching manager:\", error);\n        return null;\n    }\n}\n// Helper to get user's direct reports from Microsoft Graph\n// Accepts an optional userIdOrUpn to fetch reports for a specific user, \n// otherwise defaults to the user in the provided token (effectively \"/me\").\nasync function getUserDirectReports(token, userIdOrUpn) {\n    try {\n        const graphToken = await getGraphApiToken(); // This uses client credentials, not the user's token\n        let targetUserId = userIdOrUpn; // Use provided userIdOrUpn if available\n        if (!targetUserId) {\n            // If userIdOrUpn is not provided, get the user ID from the *user's* token for /me equivalent\n            const decodedUserToken = JSON.parse(Buffer.from(token.split(\".\")[1], \"base64\").toString());\n            targetUserId = decodedUserToken.oid || decodedUserToken.sub;\n            if (!targetUserId) {\n                console.error(\"[getUserDirectReports] Could not extract user ID from provided token when userIdOrUpn is not specified.\");\n                return [];\n            }\n            console.log(`[getUserDirectReports] Fetching reports for user from token (me): ${targetUserId}`);\n        } else {\n            console.log(`[getUserDirectReports] Fetching reports for specified user: ${targetUserId}`);\n        }\n        const endpoint = `https://graph.microsoft.com/v1.0/users/${targetUserId}/directReports?$select=id,displayName,userPrincipalName`;\n        const response = await fetch(endpoint, {\n            headers: {\n                Authorization: `Bearer ${graphToken}`,\n                \"Content-Type\": \"application/json\"\n            }\n        });\n        if (!response.ok) {\n            const body = await response.text();\n            console.error(\" Error fetching direct reports:\", {\n                status: response.status,\n                statusText: response.statusText,\n                error: body\n            });\n            return [];\n        }\n        const data = await response.json();\n        return data.value || [];\n    } catch (error) {\n        console.error(\"Error fetching direct reports:\", error);\n        return [];\n    }\n}\n// Helper function to check if user has required role\nfunction hasRole(roles, requiredRole) {\n    return roles.includes(requiredRole);\n}\n// Helper function to check if user has any of the required roles\nfunction hasAnyRole(roles, requiredRoles) {\n    return requiredRoles.some((role)=>roles.includes(role));\n}\n// Helper function to check if user is accessing their own data\nfunction isSelfAccess(userId, targetId) {\n    return userId === targetId;\n}\n// Helper function to check if user is a manager\nfunction isManager(roles) {\n    return hasRole(roles, \"manager\");\n}\n// Helper function to check if user is an admin\nfunction isAdmin(roles) {\n    return hasRole(roles, \"admin\");\n}\n// Authentication middleware\nfunction withAuth(handler) {\n    return async (req, res)=>{\n        try {\n            // Get the authorization header\n            const authHeader = req.headers.authorization;\n            if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n                return res.status(401).json({\n                    error: \"Unauthorized\",\n                    message: \"Authentication required\",\n                    code: \"AUTH_REQUIRED\"\n                });\n            }\n            // Extract and validate token\n            const token = authHeader.split(\" \")[1];\n            const userData = await validateUserToken(token);\n            if (!userData) {\n                return res.status(401).json({\n                    error: \"Unauthorized\",\n                    message: \"Invalid or expired token\",\n                    code: \"INVALID_TOKEN\"\n                });\n            }\n            // Get selected employee ID from header\n            const selectedEmployeeId = req.headers[\"x-selected-employee-id\"];\n            if (!selectedEmployeeId) {\n                return res.status(403).json({\n                    error: \"Forbidden\",\n                    message: \"Selected employee ID is required\",\n                    code: \"EMPLOYEE_REQUIRED\"\n                });\n            }\n            // DEBUGGING: Log types and values before the query\n            console.log(\"[AuthMiddleware] Employee Validation - Type of selectedEmployeeId:\", typeof selectedEmployeeId, \"Value:\", selectedEmployeeId);\n            console.log(\"[AuthMiddleware] Employee Validation - Type of userData.id:\", typeof userData.id, \"Value:\", userData.id);\n            // Verify selected employee belongs to user\n            const employeeCheck = await (0,_lib_db_pool__WEBPACK_IMPORTED_MODULE_2__.executeQuery)(\"SELECT 1 FROM employees WHERE employee_number = $1 AND user_id = $2\", [\n                selectedEmployeeId,\n                userData.id\n            ]);\n            if (employeeCheck.length === 0) {\n                console.error(\"[AuthMiddleware] Employee validation FAILED. No match found for:\", {\n                    selectedEmployeeId,\n                    userId: userData.id,\n                    queryResult: employeeCheck\n                });\n                return res.status(403).json({\n                    error: \"Forbidden\",\n                    message: \"Selected employee does not belong to user\",\n                    code: \"INVALID_EMPLOYEE\"\n                });\n            } else {\n                console.log(\"[AuthMiddleware] Employee validation SUCCESSFUL.\");\n            }\n            // Attach user data to request\n            req.user = {\n                ...userData,\n                account: await msalInstance.getActiveAccount()\n            };\n            // Call the handler\n            await handler(req, res);\n        } catch (error) {\n            console.error(\"Authentication error in withAuth:\", error);\n            if (error instanceof _azure_msal_browser__WEBPACK_IMPORTED_MODULE_0__.InteractionRequiredAuthError) {\n                return res.status(401).json({\n                    error: \"Authentication Required\",\n                    message: \"User interaction required\",\n                    code: \"INTERACTION_REQUIRED\"\n                });\n            }\n            return res.status(500).json({\n                error: \"Internal Server Error\",\n                message: \"Authentication failed\",\n                code: \"AUTH_ERROR\"\n            });\n        }\n    };\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FBT3lFLFNBQVNsQyxFQUFFLEVBQUUsVUFBVWtDLFNBQVNsQyxFQUFFO1lBRXBILDJDQUEyQztZQUMzQyxNQUFNb0MsZ0JBQWdCLE1BQU1oSCwwREFBWUEsQ0FDdEMsdUVBQ0E7Z0JBQUMrRztnQkFBb0JELFNBQVNsQyxFQUFFO2FBQUM7WUFHbkMsSUFBSW9DLGNBQWNyRixNQUFNLEtBQUssR0FBRztnQkFDOUJDLFFBQVFDLEtBQUssQ0FBQyxvRUFBb0U7b0JBQ2hGa0Y7b0JBQ0FwRCxRQUFRbUQsU0FBU2xDLEVBQUU7b0JBQ25CcUMsYUFBYUQ7Z0JBQ2Y7Z0JBQ0EsT0FBT1AsSUFBSXBDLE1BQU0sQ0FBQyxLQUFLRyxJQUFJLENBQUM7b0JBQzFCM0MsT0FBTztvQkFDUHFELFNBQVM7b0JBQ1QyQixNQUFNO2dCQUNSO1lBQ0YsT0FBTztnQkFDTGpGLFFBQVFTLEdBQUcsQ0FBQztZQUNkO1lBRUEsOEJBQThCO1lBQzlCbUUsSUFBSWpDLElBQUksR0FBRztnQkFDVCxHQUFHdUMsUUFBUTtnQkFDWEksU0FBUyxNQUFNL0UsYUFBYWdGLGdCQUFnQjtZQUM5QztZQUVBLG1CQUFtQjtZQUNuQixNQUFNWixRQUFRQyxLQUFLQztRQUNyQixFQUFFLE9BQU81RSxPQUFPO1lBQ2RELFFBQVFDLEtBQUssQ0FBQyxxQ0FBcUNBO1lBRW5ELElBQUlBLGlCQUFpQmhDLDZFQUE0QkEsRUFBRTtnQkFDakQsT0FBTzRHLElBQUlwQyxNQUFNLENBQUMsS0FBS0csSUFBSSxDQUFDO29CQUMxQjNDLE9BQU87b0JBQ1BxRCxTQUFTO29CQUNUMkIsTUFBTTtnQkFDUjtZQUNGO1lBRUEsT0FBT0osSUFBSXBDLE1BQU0sQ0FBQyxLQUFLRyxJQUFJLENBQUM7Z0JBQzFCM0MsT0FBTztnQkFDUHFELFNBQVM7Z0JBQ1QyQixNQUFNO1lBQ1I7UUFDRjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9henVyZS1hZC1sb2dpbi1hcHAvLi9zcmMvbWlkZGxld2FyZS9hdXRoLnRzP2I5YWQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgeyBJbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yIH0gZnJvbSAnQGF6dXJlL21zYWwtYnJvd3Nlcic7XHJcbmltcG9ydCB7IFB1YmxpY0NsaWVudEFwcGxpY2F0aW9uLCBBY2NvdW50SW5mbyB9IGZyb20gJ0BhenVyZS9tc2FsLWJyb3dzZXInO1xyXG5pbXBvcnQgeyBDb25maWRlbnRpYWxDbGllbnRBcHBsaWNhdGlvbiB9IGZyb20gJ0BhenVyZS9tc2FsLW5vZGUnO1xyXG5pbXBvcnQgeyBleGVjdXRlUXVlcnkgfSBmcm9tICcuLi9saWIvZGIvcG9vbCc7XHJcblxyXG4vLyBUeXBlc1xyXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhlbnRpY2F0ZWRSZXF1ZXN0IGV4dGVuZHMgTmV4dEFwaVJlcXVlc3Qge1xyXG4gIHVzZXI/OiB7XHJcbiAgICBpZDogc3RyaW5nO1xyXG4gICAgcm9sZXM6IHN0cmluZ1tdO1xyXG4gICAgYWNjb3VudD86IEFjY291bnRJbmZvO1xyXG4gIH07XHJcbn1cclxuXHJcbi8vIE1TQUwgY29uZmlndXJhdGlvblxyXG5jb25zdCBtc2FsQ29uZmlnID0ge1xyXG4gIGF1dGg6IHtcclxuICAgIGNsaWVudElkOiBwcm9jZXNzLmVudi5BWlVSRV9BRF9DTElFTlRfSUQhLFxyXG4gICAgYXV0aG9yaXR5OiBgaHR0cHM6Ly9sb2dpbi5taWNyb3NvZnRvbmxpbmUuY29tLyR7cHJvY2Vzcy5lbnYuQVpVUkVfQURfVEVOQU5UX0lEfWAsXHJcbiAgICByZWRpcmVjdFVyaTogcHJvY2Vzcy5lbnYuQVpVUkVfQURfUkVESVJFQ1RfVVJJLFxyXG4gICAgY2xpZW50U2VjcmV0OiBwcm9jZXNzLmVudi5BWlVSRV9BRF9DTElFTlRfU0VDUkVULFxyXG4gIH0sXHJcbiAgY2FjaGU6IHtcclxuICAgIGNhY2hlTG9jYXRpb246ICdsb2NhbFN0b3JhZ2UnLFxyXG4gICAgc3RvcmVBdXRoU3RhdGVJbkNvb2tpZTogZmFsc2UsXHJcbiAgfSxcclxufTtcclxuXHJcbi8vIE1TQUwgTm9kZSBjb25maWd1cmF0aW9uIGZvciBjbGllbnQgY3JlZGVudGlhbHNcclxuY29uc3QgbXNhbE5vZGVDb25maWcgPSB7XHJcbiAgYXV0aDoge1xyXG4gICAgY2xpZW50SWQ6IHByb2Nlc3MuZW52LkFaVVJFX0FEX0NMSUVOVF9JRCEsXHJcbiAgICBhdXRob3JpdHk6IGBodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vJHtwcm9jZXNzLmVudi5BWlVSRV9BRF9URU5BTlRfSUR9YCxcclxuICAgIGNsaWVudFNlY3JldDogcHJvY2Vzcy5lbnYuQVpVUkVfQURfQ0xJRU5UX1NFQ1JFVCxcclxuICB9XHJcbn07XHJcblxyXG4vLyBWYWxpZGF0ZSBNU0FMIGNvbmZpZ3VyYXRpb25cclxuZnVuY3Rpb24gdmFsaWRhdGVNc2FsQ29uZmlnKCkge1xyXG4gIGNvbnN0IHJlcXVpcmVkVmFycyA9IHtcclxuICAgIEFaVVJFX0FEX0NMSUVOVF9JRDogcHJvY2Vzcy5lbnYuQVpVUkVfQURfQ0xJRU5UX0lELFxyXG4gICAgQVpVUkVfQURfVEVOQU5UX0lEOiBwcm9jZXNzLmVudi5BWlVSRV9BRF9URU5BTlRfSUQsXHJcbiAgICBBWlVSRV9BRF9SRURJUkVDVF9VUkk6IHByb2Nlc3MuZW52LkFaVVJFX0FEX1JFRElSRUNUX1VSSSxcclxuICAgIEFaVVJFX0FEX0NMSUVOVF9TRUNSRVQ6IHByb2Nlc3MuZW52LkFaVVJFX0FEX0NMSUVOVF9TRUNSRVQsXHJcbiAgfTtcclxuXHJcbiAgY29uc3QgbWlzc2luZ1ZhcnMgPSBPYmplY3QuZW50cmllcyhyZXF1aXJlZFZhcnMpXHJcbiAgICAuZmlsdGVyKChbXywgdmFsdWVdKSA9PiAhdmFsdWUpXHJcbiAgICAubWFwKChba2V5XSkgPT4ga2V5KTtcclxuXHJcbiAgaWYgKG1pc3NpbmdWYXJzLmxlbmd0aCA+IDApIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgQXp1cmUgQUQgY29uZmlndXJhdGlvbjonLCB7XHJcbiAgICAgIG1pc3Npbmc6IG1pc3NpbmdWYXJzLFxyXG4gICAgICBjb25maWc6IHtcclxuICAgICAgICAuLi5yZXF1aXJlZFZhcnMsXHJcbiAgICAgICAgQVpVUkVfQURfQ0xJRU5UX1NFQ1JFVDogcmVxdWlyZWRWYXJzLkFaVVJFX0FEX0NMSUVOVF9TRUNSRVQgPyAnW1JFREFDVEVEXScgOiB1bmRlZmluZWRcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgcmVxdWlyZWQgQXp1cmUgQUQgY29uZmlndXJhdGlvbjogJHttaXNzaW5nVmFycy5qb2luKCcsICcpfWApO1xyXG4gIH1cclxufVxyXG5cclxuLy8gSW5pdGlhbGl6ZSBNU0FMIGluc3RhbmNlc1xyXG5sZXQgbXNhbEluc3RhbmNlOiBQdWJsaWNDbGllbnRBcHBsaWNhdGlvbjtcclxubGV0IGNvbmZpZGVudGlhbENsaWVudDogQ29uZmlkZW50aWFsQ2xpZW50QXBwbGljYXRpb247XHJcblxyXG50cnkge1xyXG4gIHZhbGlkYXRlTXNhbENvbmZpZygpO1xyXG4gIG1zYWxJbnN0YW5jZSA9IG5ldyBQdWJsaWNDbGllbnRBcHBsaWNhdGlvbihtc2FsQ29uZmlnKTtcclxuICBjb25maWRlbnRpYWxDbGllbnQgPSBuZXcgQ29uZmlkZW50aWFsQ2xpZW50QXBwbGljYXRpb24obXNhbE5vZGVDb25maWcpO1xyXG4gIGNvbnNvbGUubG9nKCdNU0FMIGluc3RhbmNlcyBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHknKTtcclxufSBjYXRjaCAoZXJyb3IpIHtcclxuICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBNU0FMOicsIGVycm9yKTtcclxuICB0aHJvdyBlcnJvcjtcclxufVxyXG5cclxuLy8gQ2FjaGUgZm9yIEdyYXBoIEFQSSB0b2tlblxyXG5sZXQgZ3JhcGhUb2tlbkNhY2hlOiB7XHJcbiAgdG9rZW46IHN0cmluZztcclxuICBleHBpcmVzQXQ6IG51bWJlcjtcclxufSB8IG51bGwgPSBudWxsO1xyXG5cclxuLy8gSGVscGVyIHRvIGdldCBHcmFwaCBBUEkgdG9rZW4gdXNpbmcgY2xpZW50IGNyZWRlbnRpYWxzXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEdyYXBoQXBpVG9rZW4oKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAvLyBDaGVjayBpZiB3ZSBoYXZlIGEgdmFsaWQgY2FjaGVkIHRva2VuXHJcbiAgaWYgKGdyYXBoVG9rZW5DYWNoZSAmJiBncmFwaFRva2VuQ2FjaGUuZXhwaXJlc0F0ID4gRGF0ZS5ub3coKSArIDYwMDAwKSB7IC8vIDEgbWludXRlIGJ1ZmZlclxyXG4gICAgcmV0dXJuIGdyYXBoVG9rZW5DYWNoZS50b2tlbjtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb25maWRlbnRpYWxDbGllbnQuYWNxdWlyZVRva2VuQnlDbGllbnRDcmVkZW50aWFsKHtcclxuICAgICAgc2NvcGVzOiBbcHJvY2Vzcy5lbnYuQVpVUkVfQURfR1JBUEhfU0NPUEUgfHwgJ2h0dHBzOi8vZ3JhcGgubWljcm9zb2Z0LmNvbS8uZGVmYXVsdCddLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCFyZXN1bHQ/LmFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGFjcXVpcmUgR3JhcGggQVBJIHRva2VuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2FjaGUgdGhlIHRva2VuXHJcbiAgICBncmFwaFRva2VuQ2FjaGUgPSB7XHJcbiAgICAgIHRva2VuOiByZXN1bHQuYWNjZXNzVG9rZW4sXHJcbiAgICAgIGV4cGlyZXNBdDogRGF0ZS5ub3coKSArIChyZXN1bHQuZXhwaXJlc0luIHx8IDM2MDApICogMTAwMCxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdC5hY2Nlc3NUb2tlbjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWNxdWlyaW5nIEdyYXBoIEFQSSB0b2tlbjonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbi8vIEhlbHBlciB0byB2YWxpZGF0ZSB1c2VyIHRva2VuXHJcbmFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlVXNlclRva2VuKHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHsgaWQ6IHN0cmluZzsgcm9sZXM6IHN0cmluZ1tdIH0gfCBudWxsPiB7XHJcbiAgY29uc29sZS5sb2coJ/CflJAgVmFsaWRhdGluZyB0b2tlbiBhZ2FpbnN0IE1pY3Jvc29mdCBHcmFwaC4uLicpO1xyXG5cclxuICB0cnkge1xyXG4gICAgLy8gR2V0IEdyYXBoIEFQSSB0b2tlbiB1c2luZyBjbGllbnQgY3JlZGVudGlhbHNcclxuICAgIGNvbnN0IGdyYXBoVG9rZW4gPSBhd2FpdCBnZXRHcmFwaEFwaVRva2VuKCk7XHJcblxyXG4gICAgLy8gRGVjb2RlIHRoZSB1c2VyIHRva2VuIHRvIGdldCB0aGUgdXNlciBJRFxyXG4gICAgY29uc3QgZGVjb2RlZFRva2VuID0gSlNPTi5wYXJzZShCdWZmZXIuZnJvbSh0b2tlbi5zcGxpdCgnLicpWzFdLCAnYmFzZTY0JykudG9TdHJpbmcoKSk7XHJcbiAgICBjb25zdCB1c2VySWQgPSBkZWNvZGVkVG9rZW4ub2lkIHx8IGRlY29kZWRUb2tlbi5zdWI7XHJcblxyXG4gICAgaWYgKCF1c2VySWQpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignQ291bGQgbm90IGV4dHJhY3QgdXNlciBJRCBmcm9tIHRva2VuJyk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVzZSB0aGUgR3JhcGggQVBJIHRva2VuIHRvIGdldCB1c2VyIGluZm9cclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHBzOi8vZ3JhcGgubWljcm9zb2Z0LmNvbS92MS4wL3VzZXJzLyR7dXNlcklkfWAsIHtcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtncmFwaFRva2VufWAsXHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIE1pY3Jvc29mdCBHcmFwaCBBUEkgZXJyb3I6Jywge1xyXG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxyXG4gICAgICAgIHN0YXR1c1RleHQ6IHJlc3BvbnNlLnN0YXR1c1RleHQsXHJcbiAgICAgICAgZXJyb3I6IGJvZHksXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgY29uc29sZS5sb2coJ+KchSBNaWNyb3NvZnQgR3JhcGggdXNlciBpbmZvOicsIHVzZXIpO1xyXG5cclxuICAgIGlmICghdXNlciB8fCAhdXNlci51c2VyUHJpbmNpcGFsTmFtZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdDb3VsZCBub3QgZXh0cmFjdCB1c2VyUHJpbmNpcGFsTmFtZSBmcm9tIEdyYXBoIEFQSSByZXNwb25zZSBmb3IgdXNlciBJRDonLCB1c2VySWQpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgdXNlciByb2xlcyBmcm9tIE1pY3Jvc29mdCBHcmFwaCBncm91cHNcclxuICAgIGNvbnN0IGdyb3Vwc1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHBzOi8vZ3JhcGgubWljcm9zb2Z0LmNvbS92MS4wL3VzZXJzLyR7dXNlcklkfS9tZW1iZXJPZmAsIHtcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtncmFwaFRva2VufWAsXHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghZ3JvdXBzUmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgZmV0Y2ggdXNlciBncm91cHMgZnJvbSBNaWNyb3NvZnQgR3JhcGgnKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBpZDogdXNlci51c2VyUHJpbmNpcGFsTmFtZSxcclxuICAgICAgICByb2xlczogW11cclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBncm91cHMgPSBhd2FpdCBncm91cHNSZXNwb25zZS5qc29uKCk7XHJcbiAgICBjb25zdCByb2xlcyA9IGdyb3Vwcy52YWx1ZVxyXG4gICAgICAuZmlsdGVyKChncm91cDogYW55KSA9PiBncm91cFsnQG9kYXRhLnR5cGUnXSA9PT0gJyNtaWNyb3NvZnQuZ3JhcGguZ3JvdXAnKVxyXG4gICAgICAubWFwKChncm91cDogYW55KSA9PiBncm91cC5kaXNwbGF5TmFtZS50b0xvd2VyQ2FzZSgpKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnVXNlciByb2xlcyBmcm9tIE1pY3Jvc29mdCBHcmFwaDonLCByb2xlcyk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpZDogdXNlci51c2VyUHJpbmNpcGFsTmFtZSxcclxuICAgICAgcm9sZXM6IHJvbGVzXHJcbiAgICB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdUb2tlbiB2YWxpZGF0aW9uIGVycm9yOicsIHtcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxyXG4gICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLy8gSGVscGVyIHRvIGdldCB1c2VyJ3MgbWFuYWdlciBmcm9tIE1pY3Jvc29mdCBHcmFwaFxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlck1hbmFnZXIodG9rZW46IHN0cmluZyk6IFByb21pc2U8YW55PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGdyYXBoVG9rZW4gPSBhd2FpdCBnZXRHcmFwaEFwaVRva2VuKCk7XHJcbiAgICBcclxuICAgIC8vIERlY29kZSB0aGUgdXNlciB0b2tlbiB0byBnZXQgdGhlIHVzZXIgSURcclxuICAgIGNvbnN0IGRlY29kZWRUb2tlbiA9IEpTT04ucGFyc2UoQnVmZmVyLmZyb20odG9rZW4uc3BsaXQoJy4nKVsxXSwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkpO1xyXG4gICAgY29uc3QgdXNlcklkID0gZGVjb2RlZFRva2VuLm9pZCB8fCBkZWNvZGVkVG9rZW4uc3ViO1xyXG5cclxuICAgIGlmICghdXNlcklkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NvdWxkIG5vdCBleHRyYWN0IHVzZXIgSUQgZnJvbSB0b2tlbicpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGBodHRwczovL2dyYXBoLm1pY3Jvc29mdC5jb20vdjEuMC91c2Vycy8ke3VzZXJJZH0vbWFuYWdlcmAsIHtcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtncmFwaFRva2VufWAsXHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIG1hbmFnZXI6Jywge1xyXG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxyXG4gICAgICAgIHN0YXR1c1RleHQ6IHJlc3BvbnNlLnN0YXR1c1RleHQsXHJcbiAgICAgICAgZXJyb3I6IGJvZHksXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBtYW5hZ2VyOicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLy8gSGVscGVyIHRvIGdldCB1c2VyJ3MgZGlyZWN0IHJlcG9ydHMgZnJvbSBNaWNyb3NvZnQgR3JhcGhcclxuLy8gQWNjZXB0cyBhbiBvcHRpb25hbCB1c2VySWRPclVwbiB0byBmZXRjaCByZXBvcnRzIGZvciBhIHNwZWNpZmljIHVzZXIsIFxyXG4vLyBvdGhlcndpc2UgZGVmYXVsdHMgdG8gdGhlIHVzZXIgaW4gdGhlIHByb3ZpZGVkIHRva2VuIChlZmZlY3RpdmVseSBcIi9tZVwiKS5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJEaXJlY3RSZXBvcnRzKHRva2VuOiBzdHJpbmcsIHVzZXJJZE9yVXBuPzogc3RyaW5nKTogUHJvbWlzZTxhbnlbXT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBncmFwaFRva2VuID0gYXdhaXQgZ2V0R3JhcGhBcGlUb2tlbigpOyAvLyBUaGlzIHVzZXMgY2xpZW50IGNyZWRlbnRpYWxzLCBub3QgdGhlIHVzZXIncyB0b2tlblxyXG4gICAgXHJcbiAgICBsZXQgdGFyZ2V0VXNlcklkID0gdXNlcklkT3JVcG47IC8vIFVzZSBwcm92aWRlZCB1c2VySWRPclVwbiBpZiBhdmFpbGFibGVcclxuXHJcbiAgICBpZiAoIXRhcmdldFVzZXJJZCkge1xyXG4gICAgICAvLyBJZiB1c2VySWRPclVwbiBpcyBub3QgcHJvdmlkZWQsIGdldCB0aGUgdXNlciBJRCBmcm9tIHRoZSAqdXNlcidzKiB0b2tlbiBmb3IgL21lIGVxdWl2YWxlbnRcclxuICAgICAgY29uc3QgZGVjb2RlZFVzZXJUb2tlbiA9IEpTT04ucGFyc2UoQnVmZmVyLmZyb20odG9rZW4uc3BsaXQoJy4nKVsxXSwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkpO1xyXG4gICAgICB0YXJnZXRVc2VySWQgPSBkZWNvZGVkVXNlclRva2VuLm9pZCB8fCBkZWNvZGVkVXNlclRva2VuLnN1YjtcclxuICAgICAgaWYgKCF0YXJnZXRVc2VySWQpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdbZ2V0VXNlckRpcmVjdFJlcG9ydHNdIENvdWxkIG5vdCBleHRyYWN0IHVzZXIgSUQgZnJvbSBwcm92aWRlZCB0b2tlbiB3aGVuIHVzZXJJZE9yVXBuIGlzIG5vdCBzcGVjaWZpZWQuJyk7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbZ2V0VXNlckRpcmVjdFJlcG9ydHNdIEZldGNoaW5nIHJlcG9ydHMgZm9yIHVzZXIgZnJvbSB0b2tlbiAobWUpOiAke3RhcmdldFVzZXJJZH1gKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbZ2V0VXNlckRpcmVjdFJlcG9ydHNdIEZldGNoaW5nIHJlcG9ydHMgZm9yIHNwZWNpZmllZCB1c2VyOiAke3RhcmdldFVzZXJJZH1gKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbmRwb2ludCA9IGBodHRwczovL2dyYXBoLm1pY3Jvc29mdC5jb20vdjEuMC91c2Vycy8ke3RhcmdldFVzZXJJZH0vZGlyZWN0UmVwb3J0cz8kc2VsZWN0PWlkLGRpc3BsYXlOYW1lLHVzZXJQcmluY2lwYWxOYW1lYDtcclxuICAgIFxyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChlbmRwb2ludCwge1xyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2dyYXBoVG9rZW59YCxcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgZGlyZWN0IHJlcG9ydHM6Jywge1xyXG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxyXG4gICAgICAgIHN0YXR1c1RleHQ6IHJlc3BvbnNlLnN0YXR1c1RleHQsXHJcbiAgICAgICAgZXJyb3I6IGJvZHksXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgIHJldHVybiBkYXRhLnZhbHVlIHx8IFtdO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBkaXJlY3QgcmVwb3J0czonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG59XHJcblxyXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdXNlciBoYXMgcmVxdWlyZWQgcm9sZVxyXG5leHBvcnQgZnVuY3Rpb24gaGFzUm9sZShyb2xlczogc3RyaW5nW10sIHJlcXVpcmVkUm9sZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgcmV0dXJuIHJvbGVzLmluY2x1ZGVzKHJlcXVpcmVkUm9sZSk7XHJcbn1cclxuXHJcbi8vIEhlbHBlciBmdW5jdGlvbiB0byBjaGVjayBpZiB1c2VyIGhhcyBhbnkgb2YgdGhlIHJlcXVpcmVkIHJvbGVzXHJcbmV4cG9ydCBmdW5jdGlvbiBoYXNBbnlSb2xlKHJvbGVzOiBzdHJpbmdbXSwgcmVxdWlyZWRSb2xlczogc3RyaW5nW10pOiBib29sZWFuIHtcclxuICByZXR1cm4gcmVxdWlyZWRSb2xlcy5zb21lKHJvbGUgPT4gcm9sZXMuaW5jbHVkZXMocm9sZSkpO1xyXG59XHJcblxyXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdXNlciBpcyBhY2Nlc3NpbmcgdGhlaXIgb3duIGRhdGFcclxuZXhwb3J0IGZ1bmN0aW9uIGlzU2VsZkFjY2Vzcyh1c2VySWQ6IHN0cmluZywgdGFyZ2V0SWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gIHJldHVybiB1c2VySWQgPT09IHRhcmdldElkO1xyXG59XHJcblxyXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdXNlciBpcyBhIG1hbmFnZXJcclxuZXhwb3J0IGZ1bmN0aW9uIGlzTWFuYWdlcihyb2xlczogc3RyaW5nW10pOiBib29sZWFuIHtcclxuICByZXR1cm4gaGFzUm9sZShyb2xlcywgJ21hbmFnZXInKTtcclxufVxyXG5cclxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHVzZXIgaXMgYW4gYWRtaW5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzQWRtaW4ocm9sZXM6IHN0cmluZ1tdKTogYm9vbGVhbiB7XHJcbiAgcmV0dXJuIGhhc1JvbGUocm9sZXMsICdhZG1pbicpO1xyXG59XHJcblxyXG4vLyBBdXRoZW50aWNhdGlvbiBtaWRkbGV3YXJlXHJcbmV4cG9ydCBmdW5jdGlvbiB3aXRoQXV0aChoYW5kbGVyOiAocmVxOiBBdXRoZW50aWNhdGVkUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpID0+IFByb21pc2U8dm9pZD4pIHtcclxuICByZXR1cm4gYXN5bmMgKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBHZXQgdGhlIGF1dGhvcml6YXRpb24gaGVhZGVyXHJcbiAgICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xyXG4gICAgICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgXHJcbiAgICAgICAgICBlcnJvcjogJ1VuYXV0aG9yaXplZCcsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxyXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEV4dHJhY3QgYW5kIHZhbGlkYXRlIHRva2VuXHJcbiAgICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5zcGxpdCgnICcpWzFdO1xyXG4gICAgICBjb25zdCB1c2VyRGF0YSA9IGF3YWl0IHZhbGlkYXRlVXNlclRva2VuKHRva2VuKTtcclxuXHJcbiAgICAgIGlmICghdXNlckRhdGEpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBcclxuICAgICAgICAgIGVycm9yOiAnVW5hdXRob3JpemVkJyxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIG9yIGV4cGlyZWQgdG9rZW4nLFxyXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfVE9LRU4nXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCBzZWxlY3RlZCBlbXBsb3llZSBJRCBmcm9tIGhlYWRlclxyXG4gICAgICBjb25zdCBzZWxlY3RlZEVtcGxveWVlSWQgPSByZXEuaGVhZGVyc1sneC1zZWxlY3RlZC1lbXBsb3llZS1pZCddIGFzIHN0cmluZztcclxuICAgICAgaWYgKCFzZWxlY3RlZEVtcGxveWVlSWQpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBcclxuICAgICAgICAgIGVycm9yOiAnRm9yYmlkZGVuJyxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdTZWxlY3RlZCBlbXBsb3llZSBJRCBpcyByZXF1aXJlZCcsXHJcbiAgICAgICAgICBjb2RlOiAnRU1QTE9ZRUVfUkVRVUlSRUQnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIERFQlVHR0lORzogTG9nIHR5cGVzIGFuZCB2YWx1ZXMgYmVmb3JlIHRoZSBxdWVyeVxyXG4gICAgICBjb25zb2xlLmxvZygnW0F1dGhNaWRkbGV3YXJlXSBFbXBsb3llZSBWYWxpZGF0aW9uIC0gVHlwZSBvZiBzZWxlY3RlZEVtcGxveWVlSWQ6JywgdHlwZW9mIHNlbGVjdGVkRW1wbG95ZWVJZCwgJ1ZhbHVlOicsIHNlbGVjdGVkRW1wbG95ZWVJZCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdbQXV0aE1pZGRsZXdhcmVdIEVtcGxveWVlIFZhbGlkYXRpb24gLSBUeXBlIG9mIHVzZXJEYXRhLmlkOicsIHR5cGVvZiB1c2VyRGF0YS5pZCwgJ1ZhbHVlOicsIHVzZXJEYXRhLmlkKTtcclxuXHJcbiAgICAgIC8vIFZlcmlmeSBzZWxlY3RlZCBlbXBsb3llZSBiZWxvbmdzIHRvIHVzZXJcclxuICAgICAgY29uc3QgZW1wbG95ZWVDaGVjayA9IGF3YWl0IGV4ZWN1dGVRdWVyeShcclxuICAgICAgICAnU0VMRUNUIDEgRlJPTSBlbXBsb3llZXMgV0hFUkUgZW1wbG95ZWVfbnVtYmVyID0gJDEgQU5EIHVzZXJfaWQgPSAkMicsXHJcbiAgICAgICAgW3NlbGVjdGVkRW1wbG95ZWVJZCwgdXNlckRhdGEuaWRdXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBpZiAoZW1wbG95ZWVDaGVjay5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdbQXV0aE1pZGRsZXdhcmVdIEVtcGxveWVlIHZhbGlkYXRpb24gRkFJTEVELiBObyBtYXRjaCBmb3VuZCBmb3I6Jywge1xyXG4gICAgICAgICAgc2VsZWN0ZWRFbXBsb3llZUlkLFxyXG4gICAgICAgICAgdXNlcklkOiB1c2VyRGF0YS5pZCxcclxuICAgICAgICAgIHF1ZXJ5UmVzdWx0OiBlbXBsb3llZUNoZWNrXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgXHJcbiAgICAgICAgICBlcnJvcjogJ0ZvcmJpZGRlbicsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnU2VsZWN0ZWQgZW1wbG95ZWUgZG9lcyBub3QgYmVsb25nIHRvIHVzZXInLFxyXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfRU1QTE9ZRUUnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tBdXRoTWlkZGxld2FyZV0gRW1wbG95ZWUgdmFsaWRhdGlvbiBTVUNDRVNTRlVMLicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBBdHRhY2ggdXNlciBkYXRhIHRvIHJlcXVlc3RcclxuICAgICAgcmVxLnVzZXIgPSB7XHJcbiAgICAgICAgLi4udXNlckRhdGEsXHJcbiAgICAgICAgYWNjb3VudDogYXdhaXQgbXNhbEluc3RhbmNlLmdldEFjdGl2ZUFjY291bnQoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIENhbGwgdGhlIGhhbmRsZXJcclxuICAgICAgYXdhaXQgaGFuZGxlcihyZXEsIHJlcyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdBdXRoZW50aWNhdGlvbiBlcnJvciBpbiB3aXRoQXV0aDonLCBlcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBJbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgXHJcbiAgICAgICAgICBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIFJlcXVpcmVkJyxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIGludGVyYWN0aW9uIHJlcXVpcmVkJyxcclxuICAgICAgICAgIGNvZGU6ICdJTlRFUkFDVElPTl9SRVFVSVJFRCdcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXHJcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiBmYWlsZWQnLFxyXG4gICAgICAgIGNvZGU6ICdBVVRIX0VSUk9SJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59ICJdLCJuYW1lcyI6WyJJbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yIiwiUHVibGljQ2xpZW50QXBwbGljYXRpb24iLCJDb25maWRlbnRpYWxDbGllbnRBcHBsaWNhdGlvbiIsImV4ZWN1dGVRdWVyeSIsIm1zYWxDb25maWciLCJhdXRoIiwiY2xpZW50SWQiLCJwcm9jZXNzIiwiZW52IiwiQVpVUkVfQURfQ0xJRU5UX0lEIiwiYXV0aG9yaXR5IiwiQVpVUkVfQURfVEVOQU5UX0lEIiwicmVkaXJlY3RVcmkiLCJBWlVSRV9BRF9SRURJUkVDVF9VUkkiLCJjbGllbnRTZWNyZXQiLCJBWlVSRV9BRF9DTElFTlRfU0VDUkVUIiwiY2FjaGUiLCJjYWNoZUxvY2F0aW9uIiwic3RvcmVBdXRoU3RhdGVJbkNvb2tpZSIsIm1zYWxOb2RlQ29uZmlnIiwidmFsaWRhdGVNc2FsQ29uZmlnIiwicmVxdWlyZWRWYXJzIiwibWlzc2luZ1ZhcnMiLCJPYmplY3QiLCJlbnRyaWVzIiwiZmlsdGVyIiwiXyIsInZhbHVlIiwibWFwIiwia2V5IiwibGVuZ3RoIiwiY29uc29sZSIsImVycm9yIiwibWlzc2luZyIsImNvbmZpZyIsInVuZGVmaW5lZCIsIkVycm9yIiwiam9pbiIsIm1zYWxJbnN0YW5jZSIsImNvbmZpZGVudGlhbENsaWVudCIsImxvZyIsImdyYXBoVG9rZW5DYWNoZSIsImdldEdyYXBoQXBpVG9rZW4iLCJleHBpcmVzQXQiLCJEYXRlIiwibm93IiwidG9rZW4iLCJyZXN1bHQiLCJhY3F1aXJlVG9rZW5CeUNsaWVudENyZWRlbnRpYWwiLCJzY29wZXMiLCJBWlVSRV9BRF9HUkFQSF9TQ09QRSIsImFjY2Vzc1Rva2VuIiwiZXhwaXJlc0luIiwidmFsaWRhdGVVc2VyVG9rZW4iLCJncmFwaFRva2VuIiwiZGVjb2RlZFRva2VuIiwiSlNPTiIsInBhcnNlIiwiQnVmZmVyIiwiZnJvbSIsInNwbGl0IiwidG9TdHJpbmciLCJ1c2VySWQiLCJvaWQiLCJzdWIiLCJyZXNwb25zZSIsImZldGNoIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJvayIsImJvZHkiLCJ0ZXh0Iiwic3RhdHVzIiwic3RhdHVzVGV4dCIsInVzZXIiLCJqc29uIiwidXNlclByaW5jaXBhbE5hbWUiLCJncm91cHNSZXNwb25zZSIsIndhcm4iLCJpZCIsInJvbGVzIiwiZ3JvdXBzIiwiZ3JvdXAiLCJkaXNwbGF5TmFtZSIsInRvTG93ZXJDYXNlIiwibWVzc2FnZSIsInN0YWNrIiwiZ2V0VXNlck1hbmFnZXIiLCJnZXRVc2VyRGlyZWN0UmVwb3J0cyIsInVzZXJJZE9yVXBuIiwidGFyZ2V0VXNlcklkIiwiZGVjb2RlZFVzZXJUb2tlbiIsImVuZHBvaW50IiwiZGF0YSIsImhhc1JvbGUiLCJyZXF1aXJlZFJvbGUiLCJpbmNsdWRlcyIsImhhc0FueVJvbGUiLCJyZXF1aXJlZFJvbGVzIiwic29tZSIsInJvbGUiLCJpc1NlbGZBY2Nlc3MiLCJ0YXJnZXRJZCIsImlzTWFuYWdlciIsImlzQWRtaW4iLCJ3aXRoQXV0aCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJhdXRoSGVhZGVyIiwiYXV0aG9yaXphdGlvbiIsInN0YXJ0c1dpdGgiLCJjb2RlIiwidXNlckRhdGEiLCJzZWxlY3RlZEVtcGxveWVlSWQiLCJlbXBsb3llZUNoZWNrIiwicXVlcnlSZXN1bHQiLCJhY2NvdW50IiwiZ2V0QWN0aXZlQWNjb3VudCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/middleware/auth.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/evaluation-matrices/index.ts":
/*!****************************************************!*\
  !*** ./src/pages/api/evaluation-matrices/index.ts ***!
  \****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(pg__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _middleware_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../middleware/auth */ \"(api)/./src/middleware/auth.ts\");\n/* harmony import */ var _lib_evaluation_validation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/evaluation/validation */ \"(api)/./src/lib/evaluation/validation.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_middleware_auth__WEBPACK_IMPORTED_MODULE_1__, _lib_evaluation_validation__WEBPACK_IMPORTED_MODULE_2__]);\n([_middleware_auth__WEBPACK_IMPORTED_MODULE_1__, _lib_evaluation_validation__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nconst pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n    connectionString: process.env.DATABASE_URL,\n    ssl: {\n        rejectUnauthorized: false\n    }\n});\n// Helper to set user ID for logging (if available)\nasync function setUserForSession(client, userId) {\n    if (userId) {\n        await client.query(`SET app.current_user_id = '${userId}';`);\n    } else {\n        // Clear it if no user is provided to avoid using stale ID from pooled connection\n        await client.query(\"SET app.current_user_id = '';\");\n    }\n}\n// Exemplo de body esperado para o frontend:\n// {\n//   \"title\": \"Matriz 2024\",\n//   \"description\": \"Avaliao anual\",\n//   \"valid_from\": \"2024-01-01\",\n//   \"valid_to\": \"2024-12-31\",\n//   \"criteria\": [\n//     { \"name\": \"Critrio 1\", \"description\": \"...\", \"weight\": 50, \"is_cutting\": false },\n//     { \"name\": \"Critrio 2\", \"description\": \"...\", \"weight\": 50, \"is_cutting\": false }\n//   ],\n//   \"employee_ids\": [\"123\", \"456\", \"789\"]\n// }\nasync function getAuthenticatedSystemUserId(req) {\n    // TODO: Replace with actual MSAL or equivalent authentication logic\n    console.warn(\"Using placeholder system user ID for audit logs in evaluation matrices API. Integrate actual authentication.\");\n    return \"system-placeholder-user-id\";\n}\nasync function getSelectedEmployeeId(req) {\n    const selectedEmployeeId = req.headers[\"x-selected-employee-id\"];\n    if (!selectedEmployeeId) {\n        console.warn(\"X-Selected-Employee-ID header not found for evaluation matrices API.\");\n        return null;\n    }\n    return selectedEmployeeId;\n}\nasync function handler(req, res) {\n    const { method } = req;\n    const client = await pool.connect();\n    try {\n        if (!req.user || !req.user.id) {\n            res.status(401).json({\n                message: \"Authentication required, user ID missing.\"\n            });\n            return;\n        }\n        const actingManagerUhpn = req.user.id; // UPN of the logged-in user creating the matrix\n        if (method === \"GET\") {\n            const sqlQueryBase = `\r\n        SELECT\r\n          em.id as matrix_id,\r\n          em.title,\r\n          em.description,\r\n          em.valid_from,\r\n          em.valid_to,\r\n          em.status,\r\n          em.created_at,\r\n          em.updated_at,\r\n          em.created_by_manager_id, -- This is manager's employee_number\r\n          creator.name as employee_name,\r\n          creator.company_name as company_name,\r\n          creator.employee_number as manager_profile_employee_number, -- manager's own employee_number from employees table\r\n          json_agg(\r\n            json_build_object(\r\n              'id', ec.id,\r\n              'name', ec.name,\r\n              'description', ec.description,\r\n              'weight', ec.weight,\r\n              'is_competency_gap_critical', ec.is_competency_gap_critical,\r\n              'min_score_possible', ec.min_score_possible,\r\n              'max_score_possible', ec.max_score_possible\r\n            )\r\n          ) FILTER (WHERE ec.id IS NOT NULL) as criteria\r\n        FROM evaluation_matrices em\r\n        LEFT JOIN employees creator ON em.created_by_manager_id = creator.employee_number -- JOIN ON employee_number\r\n        LEFT JOIN evaluation_criteria ec ON em.id = ec.matrix_id\r\n      `;\n            const sqlOrderBy = `\r\n        ORDER BY em.created_at DESC\r\n      `;\n            let sqlQuery;\n            let finalParams;\n            if ((0,_middleware_auth__WEBPACK_IMPORTED_MODULE_1__.isAdmin)(req.user.roles)) {\n                sqlQuery = `\r\n          ${sqlQueryBase}\r\n          -- Admin sees all, no specific WHERE clause needed beyond $1 for structure\r\n          WHERE $1 \r\n          GROUP BY em.id, creator.employee_number\r\n          ${sqlOrderBy}\r\n        `;\n                finalParams = [\n                    true,\n                    null\n                ]; // $1=isAdmin (true), $2 not used for admin\n            } else {\n                const authHeader = req.headers.authorization;\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n                    return res.status(401).json({\n                        message: \"Authorization token is missing or invalid for Graph API call.\"\n                    });\n                }\n                const token = authHeader.split(\" \")[1];\n                try {\n                    const directReportsData = await (0,_middleware_auth__WEBPACK_IMPORTED_MODULE_1__.getUserDirectReports)(token); // Gets reports for the logged-in user (actingManagerUhpn)\n                    const subordinateUpns = directReportsData.map((report)=>report.userPrincipalName).filter((upn)=>typeof upn === \"string\" && upn.length > 0);\n                    // A manager can see matrices created by themselves or by their direct reports.\n                    const allowedCreatorUpns = [\n                        actingManagerUhpn,\n                        ...subordinateUpns\n                    ];\n                    sqlQuery = `\r\n            ${sqlQueryBase}\r\n            WHERE NOT $1 AND creator.user_id = ANY($2::TEXT[]) -- Filter: creator's UPN must be in the allowed list\r\n            GROUP BY em.id, creator.employee_number\r\n            ${sqlOrderBy}\r\n          `;\n                    finalParams = [\n                        false,\n                        allowedCreatorUpns\n                    ]; // $1=isAdmin (false), $2=array of allowed UPNs\n                } catch (graphError) {\n                    console.error(\"Failed to fetch direct reports from Graph API:\", graphError);\n                    return res.status(500).json({\n                        message: \"Failed to retrieve subordinate data for matrix filtering.\",\n                        details: graphError.message\n                    });\n                }\n            }\n            const result = await client.query(sqlQuery, finalParams);\n            res.status(200).json(result.rows);\n            return;\n        } else if (method === \"POST\") {\n            const selectedEmployeeIdHeader = req.headers[\"x-selected-employee-id\"];\n            if (!selectedEmployeeIdHeader) {\n                return res.status(400).json({\n                    message: \"x-selected-employee-id header is required (acting manager employee_number).\"\n                });\n            }\n            // Get the UPN of the employee profile the user is acting as (from the x-selected-employee-id header)\n            const actingManagerProfile = await client.query(\"SELECT user_id FROM employees WHERE employee_number = $1\", [\n                selectedEmployeeIdHeader\n            ]);\n            if (actingManagerProfile.rows.length === 0 || !actingManagerProfile.rows[0].user_id) {\n                return res.status(400).json({\n                    message: `Could not find UPN for the acting manager profile (employee_number: ${selectedEmployeeIdHeader}).`\n                });\n            }\n            const actingManagerProfileUpn = actingManagerProfile.rows[0].user_id;\n            // Ensure the logged-in user (actingManagerUhpn) matches the UPN of the selected employee profile they are trying to act as\n            if (actingManagerUhpn !== actingManagerProfileUpn) {\n                return res.status(403).json({\n                    message: \"Authenticated user UPN does not match the UPN of the selected employee profile.\"\n                });\n            }\n            const { title, description, valid_from, valid_to, status = \"draft\", criteria, employee_ids// These are subordinate employee_numbers\n             } = req.body;\n            const validationResult = await (0,_lib_evaluation_validation__WEBPACK_IMPORTED_MODULE_2__.validateMatrixInput)(req.body);\n            if (!validationResult.success) {\n                console.error(\"[API POST Matrix] Input validation failed:\", validationResult.errors);\n                return res.status(400).json({\n                    message: \"Invalid input\",\n                    errors: validationResult.errors\n                });\n            }\n            if (!employee_ids || !Array.isArray(employee_ids) || employee_ids.length === 0) {\n                return res.status(400).json({\n                    message: \"employee_ids is required and must be an array with at least one employee ID.\"\n                });\n            }\n            // Authorization: Check if the actingManagerProfileUpn is the manager of all requested subordinate employee_ids\n            const authHeader = req.headers.authorization;\n            if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n                return res.status(401).json({\n                    message: \"Authorization token is missing or invalid for Graph API call (POST).\"\n                });\n            }\n            const token = authHeader.split(\" \")[1];\n            let authorizedSubordinateEmployeeNumbers = [];\n            try {\n                // Get UPNs of direct reports to the actingManagerProfileUpn (who is the logged-in user)\n                const directReportsData = await (0,_middleware_auth__WEBPACK_IMPORTED_MODULE_1__.getUserDirectReports)(token, actingManagerProfileUpn); // Pass actingManagerProfileUpn to get *their* reports\n                const subordinateUpns = directReportsData.map((report)=>report.userPrincipalName).filter((upn)=>typeof upn === \"string\" && upn.length > 0);\n                if (subordinateUpns.length > 0) {\n                    const subordinatesQuery = await client.query(`SELECT employee_number FROM employees WHERE user_id = ANY($1::TEXT[]) AND active = true`, [\n                        subordinateUpns\n                    ]);\n                    authorizedSubordinateEmployeeNumbers = subordinatesQuery.rows.map((r)=>r.employee_number.toString());\n                }\n                console.log(`[POST Matrix Auth] Acting manager UPN: ${actingManagerProfileUpn} has authorized subordinate employee_numbers:`, authorizedSubordinateEmployeeNumbers);\n            } catch (graphError) {\n                console.error(\"[POST Matrix Auth] Failed to fetch direct reports from Graph API:\", graphError);\n                return res.status(500).json({\n                    message: \"Failed to retrieve subordinate data for authorization.\",\n                    details: graphError.message\n                });\n            }\n            const requestedSubordinateIds = employee_ids.map(String);\n            const unauthorizedRequestedIds = requestedSubordinateIds.filter((id)=>!authorizedSubordinateEmployeeNumbers.includes(id));\n            if (unauthorizedRequestedIds.length > 0) {\n                console.log(`[POST Matrix Auth] Unauthorized subordinate IDs requested:`, unauthorizedRequestedIds);\n                return res.status(403).json({\n                    message: `User (${actingManagerProfileUpn}) is not authorized for some requested subordinate employee IDs.`,\n                    unauthorized_ids: unauthorizedRequestedIds\n                });\n            }\n            console.log(`[POST Matrix Auth] All requested subordinate employee_ids are authorized for manager ${actingManagerProfileUpn}.`);\n            // If we reach here, authorization passed.\n            await client.query(\"BEGIN\");\n            // created_by_manager_id should be the employee_number of the acting manager (selectedEmployeeIdHeader)\n            // created_by and updated_by should be the UPN (actingManagerProfileUpn)\n            const matrixResult = await client.query(`INSERT INTO evaluation_matrices \r\n         (title, description, valid_from, valid_to, status, created_by_manager_id, created_by, updated_by)\r\n         VALUES ($1, $2, $3, $4, $5, $6, $7, $7)\r\n         RETURNING *`, [\n                title,\n                description,\n                valid_from,\n                valid_to,\n                status,\n                selectedEmployeeIdHeader,\n                actingManagerProfileUpn\n            ]);\n            const matrix = matrixResult.rows[0];\n            if (criteria && Array.isArray(criteria)) {\n                for (const criterion of criteria){\n                    await client.query(`INSERT INTO evaluation_criteria \r\n             (matrix_id, name, description, weight, is_competency_gap_critical, \r\n              min_score_possible, max_score_possible, created_by, updated_by)\r\n             VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $8)`, [\n                        matrix.id,\n                        criterion.name,\n                        criterion.description,\n                        criterion.weight,\n                        criterion.is_competency_gap_critical,\n                        criterion.min_score_possible,\n                        criterion.max_score_possible,\n                        actingManagerProfileUpn\n                    ]);\n                }\n            }\n            if (employee_ids && Array.isArray(employee_ids)) {\n                for (const empId of employee_ids){\n                    await client.query(`INSERT INTO matrix_applicability \r\n             (matrix_id, employee_id, valid_from, valid_to, status, created_by, updated_by)\r\n             VALUES ($1, $2, $3, $4, 'active', $5, $5)`, [\n                        matrix.id,\n                        empId,\n                        valid_from,\n                        valid_to,\n                        actingManagerProfileUpn\n                    ]);\n                }\n            }\n            await client.query(\"COMMIT\");\n            // Fetch the complete matrix with criteria\n            const completeMatrixQuery = `\r\n        SELECT\r\n          em.id as matrix_id,\r\n          em.title,\r\n          em.description,\r\n          em.valid_from,\r\n          em.valid_to,\r\n          em.status,\r\n          em.created_at,\r\n          em.updated_at,\r\n          em.created_by_manager_id,\r\n          creator.name as employee_name,\r\n          creator.company_name as company_name,\r\n          creator.employee_number as employee_number,\r\n          json_agg(\r\n            json_build_object(\r\n              'id', ec.id,\r\n              'name', ec.name,\r\n              'description', ec.description,\r\n              'weight', ec.weight,\r\n              'is_competency_gap_critical', ec.is_competency_gap_critical,\r\n              'min_score_possible', ec.min_score_possible,\r\n              'max_score_possible', ec.max_score_possible\r\n            )\r\n          ) FILTER (WHERE ec.id IS NOT NULL) as criteria\r\n        FROM evaluation_matrices em\r\n        LEFT JOIN employees creator ON em.created_by_manager_id = creator.employee_number -- Corrected JOIN\r\n        LEFT JOIN evaluation_criteria ec ON em.id = ec.matrix_id\r\n        WHERE em.id = $1\r\n        GROUP BY em.id, creator.employee_number -- Corrected GROUP BY\r\n      `;\n            const completeMatrix = await client.query(completeMatrixQuery, [\n                matrix.id\n            ]);\n            res.status(201).json(completeMatrix.rows[0] || null); // Ensure sending null if not found\n            return;\n        } else {\n            res.setHeader(\"Allow\", [\n                \"GET\",\n                \"POST\"\n            ]);\n            res.status(405).end(`Method ${method} Not Allowed for this route.`);\n            return;\n        }\n    } catch (error) {\n        if (client) {\n            await client.query(\"ROLLBACK\");\n        }\n        console.error(\"Error in matrices API:\", error);\n        // Check for specific error types if needed, e.g., error.code for pg errors\n        if (error.code === \"23505\") {\n            res.status(409).json({\n                message: \"Conflict: A similar record already exists.\",\n                details: error.detail\n            });\n        } else if (error.message.includes(\"value too long\")) {\n            res.status(400).json({\n                message: \"Bad Request: One of the provided values is too long.\"\n            });\n        } else {\n            res.status(500).json({\n                message: \"Internal Server Error\",\n                details: error.message\n            });\n        }\n        return;\n    } finally{\n        if (client) {\n            client.release();\n        }\n    }\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_middleware_auth__WEBPACK_IMPORTED_MODULE_1__.withAuth)(handler));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL2V2YWx1YXRpb24tbWF0cmljZXMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBMEI7QUFHMEY7QUFDM0M7QUFFekUsTUFBTUssT0FBTyxJQUFJTCxvQ0FBSUEsQ0FBQztJQUNwQk0sa0JBQWtCQyxRQUFRQyxHQUFHLENBQUNDLFlBQVk7SUFDMUNDLEtBQUs7UUFBRUMsb0JBQW9CO0lBQU07QUFDbkM7QUFFQSxtREFBbUQ7QUFDbkQsZUFBZUMsa0JBQWtCQyxNQUFNLEVBQUVDLE1BQU07SUFDN0MsSUFBSUEsUUFBUTtRQUNWLE1BQU1ELE9BQU9FLEtBQUssQ0FBQyxDQUFDLDJCQUEyQixFQUFFRCxPQUFPLEVBQUUsQ0FBQztJQUM3RCxPQUFPO1FBQ0wsaUZBQWlGO1FBQ2pGLE1BQU1ELE9BQU9FLEtBQUssQ0FBQztJQUNyQjtBQUNGO0FBRUEsNENBQTRDO0FBQzVDLElBQUk7QUFDSiw0QkFBNEI7QUFDNUIsc0NBQXNDO0FBQ3RDLGdDQUFnQztBQUNoQyw4QkFBOEI7QUFDOUIsa0JBQWtCO0FBQ2xCLHlGQUF5RjtBQUN6Rix3RkFBd0Y7QUFDeEYsT0FBTztBQUNQLDBDQUEwQztBQUMxQyxJQUFJO0FBRUosZUFBZUMsNkJBQTZCQyxHQUFtQjtJQUM3RCxvRUFBb0U7SUFDcEVDLFFBQVFDLElBQUksQ0FBQztJQUNiLE9BQU87QUFDVDtBQUVBLGVBQWVDLHNCQUFzQkgsR0FBbUI7SUFDdEQsTUFBTUkscUJBQXFCSixJQUFJSyxPQUFPLENBQUMseUJBQXlCO0lBQ2hFLElBQUksQ0FBQ0Qsb0JBQW9CO1FBQ3ZCSCxRQUFRQyxJQUFJLENBQUM7UUFDYixPQUFPO0lBQ1Q7SUFDQSxPQUFPRTtBQUNUO0FBRUEsZUFBZUUsUUFBUU4sR0FBeUIsRUFBRU8sR0FBb0I7SUFDcEUsTUFBTSxFQUFFQyxNQUFNLEVBQUUsR0FBR1I7SUFFbkIsTUFBTUosU0FBUyxNQUFNUixLQUFLcUIsT0FBTztJQUNqQyxJQUFJO1FBQ0YsSUFB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cyI6WyJ3ZWJwYWNrOi8vYXp1cmUtYWQtbG9naW4tYXBwLy4vc3JjL3BhZ2VzL2FwaS9ldmFsdWF0aW9uLW1hdHJpY2VzL2luZGV4LnRzPzA1NzciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUG9vbCB9IGZyb20gJ3BnJztcclxuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgeyBnZXRBbGxBY3RpdmVFbXBsb3llZXMsIGdldEVtcGxveWVlRGV0YWlsc0J5VXNlcklkLCBnZXRFbXBsb3llZURldGFpbHNCeU51bWJlciB9IGZyb20gJy4uLy4uLy4uL2xpYi9lbXBsb3llZURiU2VydmljZSc7XHJcbmltcG9ydCB7IHdpdGhBdXRoLCBBdXRoZW50aWNhdGVkUmVxdWVzdCwgaXNBZG1pbiwgaXNNYW5hZ2VyLCBnZXRVc2VyRGlyZWN0UmVwb3J0cyB9IGZyb20gJy4uLy4uLy4uL21pZGRsZXdhcmUvYXV0aCc7XHJcbmltcG9ydCB7IHZhbGlkYXRlTWF0cml4SW5wdXQgfSBmcm9tICcuLi8uLi8uLi9saWIvZXZhbHVhdGlvbi92YWxpZGF0aW9uJztcclxuXHJcbmNvbnN0IHBvb2wgPSBuZXcgUG9vbCh7XHJcbiAgY29ubmVjdGlvblN0cmluZzogcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMLFxyXG4gIHNzbDogeyByZWplY3RVbmF1dGhvcml6ZWQ6IGZhbHNlIH0sXHJcbn0pO1xyXG5cclxuLy8gSGVscGVyIHRvIHNldCB1c2VyIElEIGZvciBsb2dnaW5nIChpZiBhdmFpbGFibGUpXHJcbmFzeW5jIGZ1bmN0aW9uIHNldFVzZXJGb3JTZXNzaW9uKGNsaWVudCwgdXNlcklkKSB7XHJcbiAgaWYgKHVzZXJJZCkge1xyXG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KGBTRVQgYXBwLmN1cnJlbnRfdXNlcl9pZCA9ICcke3VzZXJJZH0nO2ApO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAvLyBDbGVhciBpdCBpZiBubyB1c2VyIGlzIHByb3ZpZGVkIHRvIGF2b2lkIHVzaW5nIHN0YWxlIElEIGZyb20gcG9vbGVkIGNvbm5lY3Rpb25cclxuICAgIGF3YWl0IGNsaWVudC5xdWVyeShcIlNFVCBhcHAuY3VycmVudF91c2VyX2lkID0gJyc7XCIpO1xyXG4gIH1cclxufVxyXG5cclxuLy8gRXhlbXBsbyBkZSBib2R5IGVzcGVyYWRvIHBhcmEgbyBmcm9udGVuZDpcclxuLy8ge1xyXG4vLyAgIFwidGl0bGVcIjogXCJNYXRyaXogMjAyNFwiLFxyXG4vLyAgIFwiZGVzY3JpcHRpb25cIjogXCJBdmFsaWHDp8OjbyBhbnVhbFwiLFxyXG4vLyAgIFwidmFsaWRfZnJvbVwiOiBcIjIwMjQtMDEtMDFcIixcclxuLy8gICBcInZhbGlkX3RvXCI6IFwiMjAyNC0xMi0zMVwiLFxyXG4vLyAgIFwiY3JpdGVyaWFcIjogW1xyXG4vLyAgICAgeyBcIm5hbWVcIjogXCJDcml0w6lyaW8gMVwiLCBcImRlc2NyaXB0aW9uXCI6IFwiLi4uXCIsIFwid2VpZ2h0XCI6IDUwLCBcImlzX2N1dHRpbmdcIjogZmFsc2UgfSxcclxuLy8gICAgIHsgXCJuYW1lXCI6IFwiQ3JpdMOpcmlvIDJcIiwgXCJkZXNjcmlwdGlvblwiOiBcIi4uLlwiLCBcIndlaWdodFwiOiA1MCwgXCJpc19jdXR0aW5nXCI6IGZhbHNlIH1cclxuLy8gICBdLFxyXG4vLyAgIFwiZW1wbG95ZWVfaWRzXCI6IFtcIjEyM1wiLCBcIjQ1NlwiLCBcIjc4OVwiXVxyXG4vLyB9XHJcblxyXG5hc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkU3lzdGVtVXNlcklkKHJlcTogTmV4dEFwaVJlcXVlc3QpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcclxuICAvLyBUT0RPOiBSZXBsYWNlIHdpdGggYWN0dWFsIE1TQUwgb3IgZXF1aXZhbGVudCBhdXRoZW50aWNhdGlvbiBsb2dpY1xyXG4gIGNvbnNvbGUud2FybignVXNpbmcgcGxhY2Vob2xkZXIgc3lzdGVtIHVzZXIgSUQgZm9yIGF1ZGl0IGxvZ3MgaW4gZXZhbHVhdGlvbiBtYXRyaWNlcyBBUEkuIEludGVncmF0ZSBhY3R1YWwgYXV0aGVudGljYXRpb24uJyk7XHJcbiAgcmV0dXJuICdzeXN0ZW0tcGxhY2Vob2xkZXItdXNlci1pZCc7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldFNlbGVjdGVkRW1wbG95ZWVJZChyZXE6IE5leHRBcGlSZXF1ZXN0KTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XHJcbiAgY29uc3Qgc2VsZWN0ZWRFbXBsb3llZUlkID0gcmVxLmhlYWRlcnNbJ3gtc2VsZWN0ZWQtZW1wbG95ZWUtaWQnXSBhcyBzdHJpbmc7XHJcbiAgaWYgKCFzZWxlY3RlZEVtcGxveWVlSWQpIHtcclxuICAgIGNvbnNvbGUud2FybignWC1TZWxlY3RlZC1FbXBsb3llZS1JRCBoZWFkZXIgbm90IGZvdW5kIGZvciBldmFsdWF0aW9uIG1hdHJpY2VzIEFQSS4nKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuICByZXR1cm4gc2VsZWN0ZWRFbXBsb3llZUlkO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgY29uc3QgeyBtZXRob2QgfSA9IHJlcTtcclxuXHJcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgcG9vbC5jb25uZWN0KCk7XHJcbiAgdHJ5IHtcclxuICAgIGlmICghcmVxLnVzZXIgfHwgIXJlcS51c2VyLmlkKSB7XHJcbiAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkLCB1c2VyIElEIG1pc3NpbmcuJyB9KTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGFjdGluZ01hbmFnZXJVaHBuID0gcmVxLnVzZXIuaWQ7IC8vIFVQTiBvZiB0aGUgbG9nZ2VkLWluIHVzZXIgY3JlYXRpbmcgdGhlIG1hdHJpeFxyXG5cclxuICAgIGlmIChtZXRob2QgPT09ICdHRVQnKSB7XHJcbiAgICAgIGNvbnN0IHNxbFF1ZXJ5QmFzZSA9IGBcclxuICAgICAgICBTRUxFQ1RcclxuICAgICAgICAgIGVtLmlkIGFzIG1hdHJpeF9pZCxcclxuICAgICAgICAgIGVtLnRpdGxlLFxyXG4gICAgICAgICAgZW0uZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICBlbS52YWxpZF9mcm9tLFxyXG4gICAgICAgICAgZW0udmFsaWRfdG8sXHJcbiAgICAgICAgICBlbS5zdGF0dXMsXHJcbiAgICAgICAgICBlbS5jcmVhdGVkX2F0LFxyXG4gICAgICAgICAgZW0udXBkYXRlZF9hdCxcclxuICAgICAgICAgIGVtLmNyZWF0ZWRfYnlfbWFuYWdlcl9pZCwgLS0gVGhpcyBpcyBtYW5hZ2VyJ3MgZW1wbG95ZWVfbnVtYmVyXHJcbiAgICAgICAgICBjcmVhdG9yLm5hbWUgYXMgZW1wbG95ZWVfbmFtZSxcclxuICAgICAgICAgIGNyZWF0b3IuY29tcGFueV9uYW1lIGFzIGNvbXBhbnlfbmFtZSxcclxuICAgICAgICAgIGNyZWF0b3IuZW1wbG95ZWVfbnVtYmVyIGFzIG1hbmFnZXJfcHJvZmlsZV9lbXBsb3llZV9udW1iZXIsIC0tIG1hbmFnZXIncyBvd24gZW1wbG95ZWVfbnVtYmVyIGZyb20gZW1wbG95ZWVzIHRhYmxlXHJcbiAgICAgICAgICBqc29uX2FnZyhcclxuICAgICAgICAgICAganNvbl9idWlsZF9vYmplY3QoXHJcbiAgICAgICAgICAgICAgJ2lkJywgZWMuaWQsXHJcbiAgICAgICAgICAgICAgJ25hbWUnLCBlYy5uYW1lLFxyXG4gICAgICAgICAgICAgICdkZXNjcmlwdGlvbicsIGVjLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICd3ZWlnaHQnLCBlYy53ZWlnaHQsXHJcbiAgICAgICAgICAgICAgJ2lzX2NvbXBldGVuY3lfZ2FwX2NyaXRpY2FsJywgZWMuaXNfY29tcGV0ZW5jeV9nYXBfY3JpdGljYWwsXHJcbiAgICAgICAgICAgICAgJ21pbl9zY29yZV9wb3NzaWJsZScsIGVjLm1pbl9zY29yZV9wb3NzaWJsZSxcclxuICAgICAgICAgICAgICAnbWF4X3Njb3JlX3Bvc3NpYmxlJywgZWMubWF4X3Njb3JlX3Bvc3NpYmxlXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICkgRklMVEVSIChXSEVSRSBlYy5pZCBJUyBOT1QgTlVMTCkgYXMgY3JpdGVyaWFcclxuICAgICAgICBGUk9NIGV2YWx1YXRpb25fbWF0cmljZXMgZW1cclxuICAgICAgICBMRUZUIEpPSU4gZW1wbG95ZWVzIGNyZWF0b3IgT04gZW0uY3JlYXRlZF9ieV9tYW5hZ2VyX2lkID0gY3JlYXRvci5lbXBsb3llZV9udW1iZXIgLS0gSk9JTiBPTiBlbXBsb3llZV9udW1iZXJcclxuICAgICAgICBMRUZUIEpPSU4gZXZhbHVhdGlvbl9jcml0ZXJpYSBlYyBPTiBlbS5pZCA9IGVjLm1hdHJpeF9pZFxyXG4gICAgICBgO1xyXG4gICAgICBjb25zdCBzcWxPcmRlckJ5ID0gYFxyXG4gICAgICAgIE9SREVSIEJZIGVtLmNyZWF0ZWRfYXQgREVTQ1xyXG4gICAgICBgO1xyXG4gICAgICBcclxuICAgICAgbGV0IHNxbFF1ZXJ5OiBzdHJpbmc7XHJcbiAgICAgIGxldCBmaW5hbFBhcmFtczogYW55W107XHJcblxyXG4gICAgICBpZiAoaXNBZG1pbihyZXEudXNlci5yb2xlcykpIHtcclxuICAgICAgICBzcWxRdWVyeSA9IGBcclxuICAgICAgICAgICR7c3FsUXVlcnlCYXNlfVxyXG4gICAgICAgICAgLS0gQWRtaW4gc2VlcyBhbGwsIG5vIHNwZWNpZmljIFdIRVJFIGNsYXVzZSBuZWVkZWQgYmV5b25kICQxIGZvciBzdHJ1Y3R1cmVcclxuICAgICAgICAgIFdIRVJFICQxIFxyXG4gICAgICAgICAgR1JPVVAgQlkgZW0uaWQsIGNyZWF0b3IuZW1wbG95ZWVfbnVtYmVyXHJcbiAgICAgICAgICAke3NxbE9yZGVyQnl9XHJcbiAgICAgICAgYDtcclxuICAgICAgICBmaW5hbFBhcmFtcyA9IFt0cnVlLCBudWxsXTsgLy8gJDE9aXNBZG1pbiAodHJ1ZSksICQyIG5vdCB1c2VkIGZvciBhZG1pblxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xyXG4gICAgICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdBdXRob3JpemF0aW9uIHRva2VuIGlzIG1pc3Npbmcgb3IgaW52YWxpZCBmb3IgR3JhcGggQVBJIGNhbGwuJyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnNwbGl0KCcgJylbMV07XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBkaXJlY3RSZXBvcnRzRGF0YSA9IGF3YWl0IGdldFVzZXJEaXJlY3RSZXBvcnRzKHRva2VuKTsgLy8gR2V0cyByZXBvcnRzIGZvciB0aGUgbG9nZ2VkLWluIHVzZXIgKGFjdGluZ01hbmFnZXJVaHBuKVxyXG4gICAgICAgICAgY29uc3Qgc3Vib3JkaW5hdGVVcG5zID0gZGlyZWN0UmVwb3J0c0RhdGFcclxuICAgICAgICAgICAgLm1hcChyZXBvcnQgPT4gcmVwb3J0LnVzZXJQcmluY2lwYWxOYW1lKVxyXG4gICAgICAgICAgICAuZmlsdGVyKHVwbiA9PiB0eXBlb2YgdXBuID09PSAnc3RyaW5nJyAmJiB1cG4ubGVuZ3RoID4gMCk7XHJcblxyXG4gICAgICAgICAgLy8gQSBtYW5hZ2VyIGNhbiBzZWUgbWF0cmljZXMgY3JlYXRlZCBieSB0aGVtc2VsdmVzIG9yIGJ5IHRoZWlyIGRpcmVjdCByZXBvcnRzLlxyXG4gICAgICAgICAgY29uc3QgYWxsb3dlZENyZWF0b3JVcG5zID0gW2FjdGluZ01hbmFnZXJVaHBuLCAuLi5zdWJvcmRpbmF0ZVVwbnNdO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBzcWxRdWVyeSA9IGBcclxuICAgICAgICAgICAgJHtzcWxRdWVyeUJhc2V9XHJcbiAgICAgICAgICAgIFdIRVJFIE5PVCAkMSBBTkQgY3JlYXRvci51c2VyX2lkID0gQU5ZKCQyOjpURVhUW10pIC0tIEZpbHRlcjogY3JlYXRvcidzIFVQTiBtdXN0IGJlIGluIHRoZSBhbGxvd2VkIGxpc3RcclxuICAgICAgICAgICAgR1JPVVAgQlkgZW0uaWQsIGNyZWF0b3IuZW1wbG95ZWVfbnVtYmVyXHJcbiAgICAgICAgICAgICR7c3FsT3JkZXJCeX1cclxuICAgICAgICAgIGA7XHJcbiAgICAgICAgICBmaW5hbFBhcmFtcyA9IFtmYWxzZSwgYWxsb3dlZENyZWF0b3JVcG5zXTsgLy8gJDE9aXNBZG1pbiAoZmFsc2UpLCAkMj1hcnJheSBvZiBhbGxvd2VkIFVQTnNcclxuXHJcbiAgICAgICAgfSBjYXRjaCAoZ3JhcGhFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGZldGNoIGRpcmVjdCByZXBvcnRzIGZyb20gR3JhcGggQVBJOicsIGdyYXBoRXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byByZXRyaWV2ZSBzdWJvcmRpbmF0ZSBkYXRhIGZvciBtYXRyaXggZmlsdGVyaW5nLicsIGRldGFpbHM6IGdyYXBoRXJyb3IubWVzc2FnZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2xpZW50LnF1ZXJ5KHNxbFF1ZXJ5LCBmaW5hbFBhcmFtcyk7XHJcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHJlc3VsdC5yb3dzKTtcclxuICAgICAgcmV0dXJuO1xyXG5cclxuICAgIH0gZWxzZSBpZiAobWV0aG9kID09PSAnUE9TVCcpIHtcclxuICAgICAgY29uc3Qgc2VsZWN0ZWRFbXBsb3llZUlkSGVhZGVyID0gcmVxLmhlYWRlcnNbJ3gtc2VsZWN0ZWQtZW1wbG95ZWUtaWQnXSBhcyBzdHJpbmc7XHJcbiAgICAgIGlmICghc2VsZWN0ZWRFbXBsb3llZUlkSGVhZGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ3gtc2VsZWN0ZWQtZW1wbG95ZWUtaWQgaGVhZGVyIGlzIHJlcXVpcmVkIChhY3RpbmcgbWFuYWdlciBlbXBsb3llZV9udW1iZXIpLicgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCB0aGUgVVBOIG9mIHRoZSBlbXBsb3llZSBwcm9maWxlIHRoZSB1c2VyIGlzIGFjdGluZyBhcyAoZnJvbSB0aGUgeC1zZWxlY3RlZC1lbXBsb3llZS1pZCBoZWFkZXIpXHJcbiAgICAgIGNvbnN0IGFjdGluZ01hbmFnZXJQcm9maWxlID0gYXdhaXQgY2xpZW50LnF1ZXJ5KCdTRUxFQ1QgdXNlcl9pZCBGUk9NIGVtcGxveWVlcyBXSEVSRSBlbXBsb3llZV9udW1iZXIgPSAkMScsIFtzZWxlY3RlZEVtcGxveWVlSWRIZWFkZXJdKTtcclxuICAgICAgaWYgKGFjdGluZ01hbmFnZXJQcm9maWxlLnJvd3MubGVuZ3RoID09PSAwIHx8ICFhY3RpbmdNYW5hZ2VyUHJvZmlsZS5yb3dzWzBdLnVzZXJfaWQpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiBgQ291bGQgbm90IGZpbmQgVVBOIGZvciB0aGUgYWN0aW5nIG1hbmFnZXIgcHJvZmlsZSAoZW1wbG95ZWVfbnVtYmVyOiAke3NlbGVjdGVkRW1wbG95ZWVJZEhlYWRlcn0pLmAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgYWN0aW5nTWFuYWdlclByb2ZpbGVVcG4gPSBhY3RpbmdNYW5hZ2VyUHJvZmlsZS5yb3dzWzBdLnVzZXJfaWQ7XHJcblxyXG4gICAgICAvLyBFbnN1cmUgdGhlIGxvZ2dlZC1pbiB1c2VyIChhY3RpbmdNYW5hZ2VyVWhwbikgbWF0Y2hlcyB0aGUgVVBOIG9mIHRoZSBzZWxlY3RlZCBlbXBsb3llZSBwcm9maWxlIHRoZXkgYXJlIHRyeWluZyB0byBhY3QgYXNcclxuICAgICAgaWYgKGFjdGluZ01hbmFnZXJVaHBuICE9PSBhY3RpbmdNYW5hZ2VyUHJvZmlsZVVwbikge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdBdXRoZW50aWNhdGVkIHVzZXIgVVBOIGRvZXMgbm90IG1hdGNoIHRoZSBVUE4gb2YgdGhlIHNlbGVjdGVkIGVtcGxveWVlIHByb2ZpbGUuJyB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBcclxuICAgICAgICB0aXRsZSwgXHJcbiAgICAgICAgZGVzY3JpcHRpb24sIFxyXG4gICAgICAgIHZhbGlkX2Zyb20sIFxyXG4gICAgICAgIHZhbGlkX3RvLCBcclxuICAgICAgICBzdGF0dXMgPSAnZHJhZnQnLFxyXG4gICAgICAgIGNyaXRlcmlhLFxyXG4gICAgICAgIGVtcGxveWVlX2lkcyAvLyBUaGVzZSBhcmUgc3Vib3JkaW5hdGUgZW1wbG95ZWVfbnVtYmVyc1xyXG4gICAgICB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVNYXRyaXhJbnB1dChyZXEuYm9keSk7XHJcbiAgICAgIGlmICghdmFsaWRhdGlvblJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignW0FQSSBQT1NUIE1hdHJpeF0gSW5wdXQgdmFsaWRhdGlvbiBmYWlsZWQ6JywgdmFsaWRhdGlvblJlc3VsdC5lcnJvcnMpO1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdJbnZhbGlkIGlucHV0JywgZXJyb3JzOiB2YWxpZGF0aW9uUmVzdWx0LmVycm9ycyB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFlbXBsb3llZV9pZHMgfHwgIUFycmF5LmlzQXJyYXkoZW1wbG95ZWVfaWRzKSB8fCBlbXBsb3llZV9pZHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ2VtcGxveWVlX2lkcyBpcyByZXF1aXJlZCBhbmQgbXVzdCBiZSBhbiBhcnJheSB3aXRoIGF0IGxlYXN0IG9uZSBlbXBsb3llZSBJRC4nIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBBdXRob3JpemF0aW9uOiBDaGVjayBpZiB0aGUgYWN0aW5nTWFuYWdlclByb2ZpbGVVcG4gaXMgdGhlIG1hbmFnZXIgb2YgYWxsIHJlcXVlc3RlZCBzdWJvcmRpbmF0ZSBlbXBsb3llZV9pZHNcclxuICAgICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XHJcbiAgICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnQXV0aG9yaXphdGlvbiB0b2tlbiBpcyBtaXNzaW5nIG9yIGludmFsaWQgZm9yIEdyYXBoIEFQSSBjYWxsIChQT1NUKS4nIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5zcGxpdCgnICcpWzFdO1xyXG4gICAgICBsZXQgYXV0aG9yaXplZFN1Ym9yZGluYXRlRW1wbG95ZWVOdW1iZXJzOiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICAvLyBHZXQgVVBOcyBvZiBkaXJlY3QgcmVwb3J0cyB0byB0aGUgYWN0aW5nTWFuYWdlclByb2ZpbGVVcG4gKHdobyBpcyB0aGUgbG9nZ2VkLWluIHVzZXIpXHJcbiAgICAgICAgY29uc3QgZGlyZWN0UmVwb3J0c0RhdGEgPSBhd2FpdCBnZXRVc2VyRGlyZWN0UmVwb3J0cyh0b2tlbiwgYWN0aW5nTWFuYWdlclByb2ZpbGVVcG4pOyAvLyBQYXNzIGFjdGluZ01hbmFnZXJQcm9maWxlVXBuIHRvIGdldCAqdGhlaXIqIHJlcG9ydHNcclxuICAgICAgICBjb25zdCBzdWJvcmRpbmF0ZVVwbnMgPSBkaXJlY3RSZXBvcnRzRGF0YVxyXG4gICAgICAgICAgLm1hcChyZXBvcnQgPT4gcmVwb3J0LnVzZXJQcmluY2lwYWxOYW1lKVxyXG4gICAgICAgICAgLmZpbHRlcih1cG4gPT4gdHlwZW9mIHVwbiA9PT0gJ3N0cmluZycgJiYgdXBuLmxlbmd0aCA+IDApO1xyXG5cclxuICAgICAgICBpZiAoc3Vib3JkaW5hdGVVcG5zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGNvbnN0IHN1Ym9yZGluYXRlc1F1ZXJ5ID0gYXdhaXQgY2xpZW50LnF1ZXJ5KFxyXG4gICAgICAgICAgICBgU0VMRUNUIGVtcGxveWVlX251bWJlciBGUk9NIGVtcGxveWVlcyBXSEVSRSB1c2VyX2lkID0gQU5ZKCQxOjpURVhUW10pIEFORCBhY3RpdmUgPSB0cnVlYCxcclxuICAgICAgICAgICAgW3N1Ym9yZGluYXRlVXBuc11cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBhdXRob3JpemVkU3Vib3JkaW5hdGVFbXBsb3llZU51bWJlcnMgPSBzdWJvcmRpbmF0ZXNRdWVyeS5yb3dzLm1hcChyID0+IHIuZW1wbG95ZWVfbnVtYmVyLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZyhgW1BPU1QgTWF0cml4IEF1dGhdIEFjdGluZyBtYW5hZ2VyIFVQTjogJHthY3RpbmdNYW5hZ2VyUHJvZmlsZVVwbn0gaGFzIGF1dGhvcml6ZWQgc3Vib3JkaW5hdGUgZW1wbG95ZWVfbnVtYmVyczpgLCBhdXRob3JpemVkU3Vib3JkaW5hdGVFbXBsb3llZU51bWJlcnMpO1xyXG4gICAgICB9IGNhdGNoIChncmFwaEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignW1BPU1QgTWF0cml4IEF1dGhdIEZhaWxlZCB0byBmZXRjaCBkaXJlY3QgcmVwb3J0cyBmcm9tIEdyYXBoIEFQSTonLCBncmFwaEVycm9yKTtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIHJldHJpZXZlIHN1Ym9yZGluYXRlIGRhdGEgZm9yIGF1dGhvcml6YXRpb24uJywgZGV0YWlsczogZ3JhcGhFcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCByZXF1ZXN0ZWRTdWJvcmRpbmF0ZUlkczogc3RyaW5nW10gPSBlbXBsb3llZV9pZHMubWFwKFN0cmluZyk7XHJcbiAgICAgIGNvbnN0IHVuYXV0aG9yaXplZFJlcXVlc3RlZElkcyA9IHJlcXVlc3RlZFN1Ym9yZGluYXRlSWRzLmZpbHRlcihpZCA9PiAhYXV0aG9yaXplZFN1Ym9yZGluYXRlRW1wbG95ZWVOdW1iZXJzLmluY2x1ZGVzKGlkKSk7XHJcblxyXG4gICAgICBpZiAodW5hdXRob3JpemVkUmVxdWVzdGVkSWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgW1BPU1QgTWF0cml4IEF1dGhdIFVuYXV0aG9yaXplZCBzdWJvcmRpbmF0ZSBJRHMgcmVxdWVzdGVkOmAsIHVuYXV0aG9yaXplZFJlcXVlc3RlZElkcyk7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgXHJcbiAgICAgICAgICBtZXNzYWdlOiBgVXNlciAoJHthY3RpbmdNYW5hZ2VyUHJvZmlsZVVwbn0pIGlzIG5vdCBhdXRob3JpemVkIGZvciBzb21lIHJlcXVlc3RlZCBzdWJvcmRpbmF0ZSBlbXBsb3llZSBJRHMuYCxcclxuICAgICAgICAgIHVuYXV0aG9yaXplZF9pZHM6IHVuYXV0aG9yaXplZFJlcXVlc3RlZElkcyBcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBjb25zb2xlLmxvZyhgW1BPU1QgTWF0cml4IEF1dGhdIEFsbCByZXF1ZXN0ZWQgc3Vib3JkaW5hdGUgZW1wbG95ZWVfaWRzIGFyZSBhdXRob3JpemVkIGZvciBtYW5hZ2VyICR7YWN0aW5nTWFuYWdlclByb2ZpbGVVcG59LmApO1xyXG5cclxuICAgICAgLy8gSWYgd2UgcmVhY2ggaGVyZSwgYXV0aG9yaXphdGlvbiBwYXNzZWQuXHJcbiAgICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnQkVHSU4nKTtcclxuICAgICAgXHJcbiAgICAgIC8vIGNyZWF0ZWRfYnlfbWFuYWdlcl9pZCBzaG91bGQgYmUgdGhlIGVtcGxveWVlX251bWJlciBvZiB0aGUgYWN0aW5nIG1hbmFnZXIgKHNlbGVjdGVkRW1wbG95ZWVJZEhlYWRlcilcclxuICAgICAgLy8gY3JlYXRlZF9ieSBhbmQgdXBkYXRlZF9ieSBzaG91bGQgYmUgdGhlIFVQTiAoYWN0aW5nTWFuYWdlclByb2ZpbGVVcG4pXHJcbiAgICAgIGNvbnN0IG1hdHJpeFJlc3VsdCA9IGF3YWl0IGNsaWVudC5xdWVyeShcclxuICAgICAgICBgSU5TRVJUIElOVE8gZXZhbHVhdGlvbl9tYXRyaWNlcyBcclxuICAgICAgICAgKHRpdGxlLCBkZXNjcmlwdGlvbiwgdmFsaWRfZnJvbSwgdmFsaWRfdG8sIHN0YXR1cywgY3JlYXRlZF9ieV9tYW5hZ2VyX2lkLCBjcmVhdGVkX2J5LCB1cGRhdGVkX2J5KVxyXG4gICAgICAgICBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSwgJDYsICQ3LCAkNylcclxuICAgICAgICAgUkVUVVJOSU5HICpgLFxyXG4gICAgICAgIFt0aXRsZSwgZGVzY3JpcHRpb24sIHZhbGlkX2Zyb20sIHZhbGlkX3RvLCBzdGF0dXMsIHNlbGVjdGVkRW1wbG95ZWVJZEhlYWRlciwgYWN0aW5nTWFuYWdlclByb2ZpbGVVcG5dXHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnN0IG1hdHJpeCA9IG1hdHJpeFJlc3VsdC5yb3dzWzBdO1xyXG5cclxuICAgICAgaWYgKGNyaXRlcmlhICYmIEFycmF5LmlzQXJyYXkoY3JpdGVyaWEpKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBjcml0ZXJpb24gb2YgY3JpdGVyaWEpIHtcclxuICAgICAgICAgIGF3YWl0IGNsaWVudC5xdWVyeShcclxuICAgICAgICAgICAgYElOU0VSVCBJTlRPIGV2YWx1YXRpb25fY3JpdGVyaWEgXHJcbiAgICAgICAgICAgICAobWF0cml4X2lkLCBuYW1lLCBkZXNjcmlwdGlvbiwgd2VpZ2h0LCBpc19jb21wZXRlbmN5X2dhcF9jcml0aWNhbCwgXHJcbiAgICAgICAgICAgICAgbWluX3Njb3JlX3Bvc3NpYmxlLCBtYXhfc2NvcmVfcG9zc2libGUsIGNyZWF0ZWRfYnksIHVwZGF0ZWRfYnkpXHJcbiAgICAgICAgICAgICBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSwgJDYsICQ3LCAkOCwgJDgpYCxcclxuICAgICAgICAgICAgW21hdHJpeC5pZCwgY3JpdGVyaW9uLm5hbWUsIGNyaXRlcmlvbi5kZXNjcmlwdGlvbiwgY3JpdGVyaW9uLndlaWdodCwgY3JpdGVyaW9uLmlzX2NvbXBldGVuY3lfZ2FwX2NyaXRpY2FsLCBjcml0ZXJpb24ubWluX3Njb3JlX3Bvc3NpYmxlLCBjcml0ZXJpb24ubWF4X3Njb3JlX3Bvc3NpYmxlLCBhY3RpbmdNYW5hZ2VyUHJvZmlsZVVwbl1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoZW1wbG95ZWVfaWRzICYmIEFycmF5LmlzQXJyYXkoZW1wbG95ZWVfaWRzKSkge1xyXG4gICAgICAgIGZvciAoY29uc3QgZW1wSWQgb2YgZW1wbG95ZWVfaWRzKSB7IFxyXG4gICAgICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KFxyXG4gICAgICAgICAgICBgSU5TRVJUIElOVE8gbWF0cml4X2FwcGxpY2FiaWxpdHkgXHJcbiAgICAgICAgICAgICAobWF0cml4X2lkLCBlbXBsb3llZV9pZCwgdmFsaWRfZnJvbSwgdmFsaWRfdG8sIHN0YXR1cywgY3JlYXRlZF9ieSwgdXBkYXRlZF9ieSlcclxuICAgICAgICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICdhY3RpdmUnLCAkNSwgJDUpYCxcclxuICAgICAgICAgICAgW21hdHJpeC5pZCwgZW1wSWQsIHZhbGlkX2Zyb20sIHZhbGlkX3RvLCBhY3RpbmdNYW5hZ2VyUHJvZmlsZVVwbl1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBhd2FpdCBjbGllbnQucXVlcnkoJ0NPTU1JVCcpO1xyXG5cclxuICAgICAgLy8gRmV0Y2ggdGhlIGNvbXBsZXRlIG1hdHJpeCB3aXRoIGNyaXRlcmlhXHJcbiAgICAgIGNvbnN0IGNvbXBsZXRlTWF0cml4UXVlcnkgPSBgXHJcbiAgICAgICAgU0VMRUNUXHJcbiAgICAgICAgICBlbS5pZCBhcyBtYXRyaXhfaWQsXHJcbiAgICAgICAgICBlbS50aXRsZSxcclxuICAgICAgICAgIGVtLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgZW0udmFsaWRfZnJvbSxcclxuICAgICAgICAgIGVtLnZhbGlkX3RvLFxyXG4gICAgICAgICAgZW0uc3RhdHVzLFxyXG4gICAgICAgICAgZW0uY3JlYXRlZF9hdCxcclxuICAgICAgICAgIGVtLnVwZGF0ZWRfYXQsXHJcbiAgICAgICAgICBlbS5jcmVhdGVkX2J5X21hbmFnZXJfaWQsXHJcbiAgICAgICAgICBjcmVhdG9yLm5hbWUgYXMgZW1wbG95ZWVfbmFtZSxcclxuICAgICAgICAgIGNyZWF0b3IuY29tcGFueV9uYW1lIGFzIGNvbXBhbnlfbmFtZSxcclxuICAgICAgICAgIGNyZWF0b3IuZW1wbG95ZWVfbnVtYmVyIGFzIGVtcGxveWVlX251bWJlcixcclxuICAgICAgICAgIGpzb25fYWdnKFxyXG4gICAgICAgICAgICBqc29uX2J1aWxkX29iamVjdChcclxuICAgICAgICAgICAgICAnaWQnLCBlYy5pZCxcclxuICAgICAgICAgICAgICAnbmFtZScsIGVjLm5hbWUsXHJcbiAgICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJywgZWMuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgJ3dlaWdodCcsIGVjLndlaWdodCxcclxuICAgICAgICAgICAgICAnaXNfY29tcGV0ZW5jeV9nYXBfY3JpdGljYWwnLCBlYy5pc19jb21wZXRlbmN5X2dhcF9jcml0aWNhbCxcclxuICAgICAgICAgICAgICAnbWluX3Njb3JlX3Bvc3NpYmxlJywgZWMubWluX3Njb3JlX3Bvc3NpYmxlLFxyXG4gICAgICAgICAgICAgICdtYXhfc2NvcmVfcG9zc2libGUnLCBlYy5tYXhfc2NvcmVfcG9zc2libGVcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgKSBGSUxURVIgKFdIRVJFIGVjLmlkIElTIE5PVCBOVUxMKSBhcyBjcml0ZXJpYVxyXG4gICAgICAgIEZST00gZXZhbHVhdGlvbl9tYXRyaWNlcyBlbVxyXG4gICAgICAgIExFRlQgSk9JTiBlbXBsb3llZXMgY3JlYXRvciBPTiBlbS5jcmVhdGVkX2J5X21hbmFnZXJfaWQgPSBjcmVhdG9yLmVtcGxveWVlX251bWJlciAtLSBDb3JyZWN0ZWQgSk9JTlxyXG4gICAgICAgIExFRlQgSk9JTiBldmFsdWF0aW9uX2NyaXRlcmlhIGVjIE9OIGVtLmlkID0gZWMubWF0cml4X2lkXHJcbiAgICAgICAgV0hFUkUgZW0uaWQgPSAkMVxyXG4gICAgICAgIEdST1VQIEJZIGVtLmlkLCBjcmVhdG9yLmVtcGxveWVlX251bWJlciAtLSBDb3JyZWN0ZWQgR1JPVVAgQllcclxuICAgICAgYDtcclxuICAgICAgY29uc3QgY29tcGxldGVNYXRyaXggPSBhd2FpdCBjbGllbnQucXVlcnkoY29tcGxldGVNYXRyaXhRdWVyeSwgW21hdHJpeC5pZF0pO1xyXG5cclxuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oY29tcGxldGVNYXRyaXgucm93c1swXSB8fCBudWxsKTsgLy8gRW5zdXJlIHNlbmRpbmcgbnVsbCBpZiBub3QgZm91bmRcclxuICAgICAgcmV0dXJuO1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydHRVQnLCAnUE9TVCddKTtcclxuICAgICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7bWV0aG9kfSBOb3QgQWxsb3dlZCBmb3IgdGhpcyByb3V0ZS5gKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBpZiAoY2xpZW50KSB7XHJcbiAgICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnUk9MTEJBQ0snKTtcclxuICAgIH1cclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIG1hdHJpY2VzIEFQSTonLCBlcnJvcik7XHJcbiAgICAvLyBDaGVjayBmb3Igc3BlY2lmaWMgZXJyb3IgdHlwZXMgaWYgbmVlZGVkLCBlLmcuLCBlcnJvci5jb2RlIGZvciBwZyBlcnJvcnNcclxuICAgIGlmIChlcnJvci5jb2RlID09PSAnMjM1MDUnKSB7IC8vIFVuaXF1ZSB2aW9sYXRpb25cclxuICAgICAgICByZXMuc3RhdHVzKDQwOSkuanNvbih7IG1lc3NhZ2U6ICdDb25mbGljdDogQSBzaW1pbGFyIHJlY29yZCBhbHJlYWR5IGV4aXN0cy4nLCBkZXRhaWxzOiBlcnJvci5kZXRhaWwgfSk7XHJcbiAgICB9IGVsc2UgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ3ZhbHVlIHRvbyBsb25nJykpIHtcclxuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdCYWQgUmVxdWVzdDogT25lIG9mIHRoZSBwcm92aWRlZCB2YWx1ZXMgaXMgdG9vIGxvbmcuJ30pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLCBkZXRhaWxzOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuO1xyXG4gIH0gZmluYWxseSB7XHJcbiAgICBpZiAoY2xpZW50KSB7XHJcbiAgICAgIGNsaWVudC5yZWxlYXNlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB3aXRoQXV0aChoYW5kbGVyKTsgIl0sIm5hbWVzIjpbIlBvb2wiLCJ3aXRoQXV0aCIsImlzQWRtaW4iLCJnZXRVc2VyRGlyZWN0UmVwb3J0cyIsInZhbGlkYXRlTWF0cml4SW5wdXQiLCJwb29sIiwiY29ubmVjdGlvblN0cmluZyIsInByb2Nlc3MiLCJlbnYiLCJEQVRBQkFTRV9VUkwiLCJzc2wiLCJyZWplY3RVbmF1dGhvcml6ZWQiLCJzZXRVc2VyRm9yU2Vzc2lvbiIsImNsaWVudCIsInVzZXJJZCIsInF1ZXJ5IiwiZ2V0QXV0aGVudGljYXRlZFN5c3RlbVVzZXJJZCIsInJlcSIsImNvbnNvbGUiLCJ3YXJuIiwiZ2V0U2VsZWN0ZWRFbXBsb3llZUlkIiwic2VsZWN0ZWRFbXBsb3llZUlkIiwiaGVhZGVycyIsImhhbmRsZXIiLCJyZXMiLCJtZXRob2QiLCJjb25uZWN0IiwidXNlciIsImlkIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJhY3RpbmdNYW5hZ2VyVWhwbiIsInNxbFF1ZXJ5QmFzZSIsInNxbE9yZGVyQnkiLCJzcWxRdWVyeSIsImZpbmFsUGFyYW1zIiwicm9sZXMiLCJhdXRoSGVhZGVyIiwiYXV0aG9yaXphdGlvbiIsInN0YXJ0c1dpdGgiLCJ0b2tlbiIsInNwbGl0IiwiZGlyZWN0UmVwb3J0c0RhdGEiLCJzdWJvcmRpbmF0ZVVwbnMiLCJtYXAiLCJyZXBvcnQiLCJ1c2VyUHJpbmNpcGFsTmFtZSIsImZpbHRlciIsInVwbiIsImxlbmd0aCIsImFsbG93ZWRDcmVhdG9yVXBucyIsImdyYXBoRXJyb3IiLCJlcnJvciIsImRldGFpbHMiLCJyZXN1bHQiLCJyb3dzIiwic2VsZWN0ZWRFbXBsb3llZUlkSGVhZGVyIiwiYWN0aW5nTWFuYWdlclByb2ZpbGUiLCJ1c2VyX2lkIiwiYWN0aW5nTWFuYWdlclByb2ZpbGVVcG4iLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwidmFsaWRfZnJvbSIsInZhbGlkX3RvIiwiY3JpdGVyaWEiLCJlbXBsb3llZV9pZHMiLCJib2R5IiwidmFsaWRhdGlvblJlc3VsdCIsInN1Y2Nlc3MiLCJlcnJvcnMiLCJBcnJheSIsImlzQXJyYXkiLCJhdXRob3JpemVkU3Vib3JkaW5hdGVFbXBsb3llZU51bWJlcnMiLCJzdWJvcmRpbmF0ZXNRdWVyeSIsInIiLCJlbXBsb3llZV9udW1iZXIiLCJ0b1N0cmluZyIsImxvZyIsInJlcXVlc3RlZFN1Ym9yZGluYXRlSWRzIiwiU3RyaW5nIiwidW5hdXRob3JpemVkUmVxdWVzdGVkSWRzIiwiaW5jbHVkZXMiLCJ1bmF1dGhvcml6ZWRfaWRzIiwibWF0cml4UmVzdWx0IiwibWF0cml4IiwiY3JpdGVyaW9uIiwibmFtZSIsIndlaWdodCIsImlzX2NvbXBldGVuY3lfZ2FwX2NyaXRpY2FsIiwibWluX3Njb3JlX3Bvc3NpYmxlIiwibWF4X3Njb3JlX3Bvc3NpYmxlIiwiZW1wSWQiLCJjb21wbGV0ZU1hdHJpeFF1ZXJ5IiwiY29tcGxldGVNYXRyaXgiLCJzZXRIZWFkZXIiLCJlbmQiLCJjb2RlIiwiZGV0YWlsIiwicmVsZWFzZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/evaluation-matrices/index.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fevaluation-matrices&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cevaluation-matrices%5Cindex.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();